<!DOCTYPE html>
<html lang="en">
<head>
  <title>PakPortal</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --primary: #a385ff;
      --primary-dark: #7a3cff;
      --accent: #42b883;
      --background: #181929;
      --background-light: #23243b;
      --card-bg: #20223d;
      --sidebar-bg: #1d1e30;
      --border: #32334a;
      --border-light: #2a2b40;
      --surface: #25263a;
      --text-main: #ececf0;
      --text-secondary: #b5b6c8;
      --text-label: #a385ff;
      --text-label-2: #42b883;
      --notification: #e53935;
      --agreement-bg: #242d3e;
      --agreement-border: #38549c;
      --agreement-icon: #56aaff;
      --product-line: #292c43;
      --section-title: #b7aaff;
      --status-done-bg: #223d27;
      --status-done-text: #43e87c;
      --status-pending-bg: #433f22;
      --status-pending-text: #ffe571;
      --gradient-orange: linear-gradient(90deg, #ff7e5f, #feb47b);
    }
    html, body {
      font-size: 16px;
      font-family: 'Roboto', 'Arial', sans-serif;
      background: var(--background);
      color: var(--text-main);
      margin: 0;
      min-height: 100vh;
      box-sizing: border-box;
      overflow-x: hidden;
    }
    body.blurred *:not(.key-modal, .key-modal *, .modal-overlay, .modal-overlay *) {
      filter: blur(3px) brightness(0.93);
      pointer-events: none !important;
      user-select: none !important;
    }
    .top-bar {
      width: 100vw;
      background: var(--background-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
      min-height: 62px;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 100;
      margin-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }
    .title {
      font-size: 28px;
      font-weight: 800;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 32px;
      letter-spacing: 1.2px;
      position: relative;
    }
    .exchange-rate {
      font-size: 14px;
      color: var(--accent);
      background: #23243b;
      border-radius: 6px;
      padding: 2px 10px;
      margin-left: 13px;
      font-weight: 700;
      letter-spacing: 1.1px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .notification-bell {
      position: relative;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 7px;
      border-radius: 50%;
      transition: background 0.2s;
      margin-left: 18px;
      color: var(--primary);
    }
    .notification-bell:hover {
      background: var(--surface);
    }
    .notification-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      min-width: 18px;
      height: 18px;
      background: var(--notification);
      color: #fff;
      border-radius: 50%;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      z-index: 2;
      padding: 0 4px;
    }
    .notification-dropdown {
      position: absolute;
      top: 52px;
      right: 0;
      width: 330px;
      max-height: 400px;
      background: var(--background-light);
      border-radius: 12px;
      z-index: 200;
      overflow-y: auto;
      padding: 0;
      display: none;
      flex-direction: column;
      animation: fadeIn 0.14s;
      border: 1px solid var(--border);
    }
    .notification-dropdown.visible {
      display: flex;
    }
    .notification-item {
      padding: 14px 18px 12px 18px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.13s;
      background: transparent;
    }
    .notification-item:last-child {
      border-bottom: none;
    }
    .notification-item:hover {
      background: var(--surface);
    }
    .notification-title {
      font-weight: 700;
      font-size: 16px;
      color: var(--primary);
      margin-bottom: 4px;
    }
    .notification-desc {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 2px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-18px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .status-bar {
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 18px;
      padding: 0 32px;
    }
    .status-bar .material-icons {
      font-size: 22px;
      vertical-align: middle;
      color: var(--border-light);
      margin-right: 2px;
    }
    .key-short {
      color: var(--primary);
      font-weight: 600;
      font-size: 18px;
      background: var(--background-light);
      border-radius: 8px;
      padding: 6px 16px;
      margin-right: 6px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .delete-btn {
      background: var(--surface);
      color: var(--primary);
      border: none;
      border-radius: 6px;
      height: 36px;
      min-width: 36px;
      padding: 0;
      font-size: 20px;
      margin-left: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .delete-btn:hover {
      background: var(--notification);
      color: #fff;
    }
    .main-stack {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 80px;
      gap: 34px;
      width: 100%;
    }
    .seller-info-section, .order-section, .card-section {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 34px 38px 26px 38px;
      max-width: 900px;
      width: 100%;
      box-sizing: border-box;
      margin: 0;
      display: flex;
      flex-direction: column;
    }
    .seller-info-title,
    .order-title,
    .section-title {
      font-size: 24px;
      font-weight: 800;
      color: var(--section-title);
      letter-spacing: 1px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid var(--product-line);
      padding-bottom: 11px;
      margin-top: 0;
    }
    .section-title.agreement {
      color: #85b9ff;
      border-bottom: 1px solid var(--agreement-border);
    }
    .seller-info-table, .order-table, .details-table {
      width: 100%;
      border-collapse: collapse;
    }
    .seller-info-table tr, .order-table tr, .details-table tr {
      border-bottom: 1px solid var(--product-line);
    }
    .seller-info-table tr:last-child,
    .order-table tr:last-child,
    .details-table tr:last-child {
      border-bottom: none;
    }
    .seller-info-label, .order-label, .details-label {
      width: 240px;
      color: var(--text-label-2);
      font-weight: 600;
      padding: 10px 0 10px 0;
      vertical-align: top;
      letter-spacing: 0.5px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .seller-info-value, .order-value, .details-value {
      color: var(--text-main);
      font-weight: 500;
      padding: 10px 0 10px 0;
      vertical-align: top;
      font-size: 16px;
    }
    .agreement-list {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0;
      font-size: 16px;
      margin-top: 0;
      margin-bottom: 0;
      border-radius: 0 0 12px 12px;
      overflow: hidden;
    }
    .agreement-header {
      display: flex;
      align-items: center;
      font-weight: 600;
      font-size: 16px;
      color: var(--text-secondary);
      background: #232b3e;
      padding: 0 18px 0 18px;
      border-bottom: 1px solid var(--agreement-border);
      min-height: 40px;
    }
    .agreement-header .agreement-col-desc {
      flex: 2 1 0;
      padding: 12px 0;
      color: #b7caf3;
      letter-spacing: 1px;
    }
    .agreement-header .agreement-col-status {
      flex: 0 0 120px;
      text-align: center;
      color: #b7caf3;
      letter-spacing: 1px;
    }
    .agreement-item {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--agreement-bg);
      border-bottom: 1px solid var(--agreement-border);
      font-weight: 500;
      transition: background 0.17s;
      min-height: 48px;
    }
    .agreement-item:last-child {
      border-bottom: none;
    }
    .agreement-col-desc {
      flex: 2 1 0;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 18px 0 18px 18px;
      color: #8dc7ff;
      font-size: 16px;
    }
    .agreement-col-status {
      flex: 0 0 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 16px;
      font-size: 16px;
    }
    .agreement-status {
      min-width: 74px;
      font-size: 14px;
      font-weight: 700;
      border-radius: 6px;
      padding: 5px 13px;
      text-align: center;
      background: var(--status-pending-bg);
      color: var(--status-pending-text);
      display: inline-block;
      letter-spacing: .5px;
    }
    .agreement-status.done {
      background: var(--status-done-bg);
      color: var(--status-done-text);
    }
    .agreement-list .material-icons,
    .seller-info-label .material-icons,
    .order-label .material-icons,
    .details-label .material-icons {
      color: var(--agreement-icon);
      font-size: 22px;
      margin-right: 4px;
      vertical-align: middle;
    }
    /* Images and popup */
    .images-row {
      display: flex;
      gap: 18px;
      margin-top: 7px;
      margin-bottom: 7px;
      flex-wrap: wrap;
    }
    .product-image {
      width: 160px;
      height: 120px;
      border-radius: 12px;
      object-fit: cover;
      border: 2px solid var(--border);
      background: #fff;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    .product-image:hover {
      border-color: var(--primary);
    }
    .fullscreen-modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0; right: 0; bottom: 0;
      width: 100vw; height: 100vh;
      background: rgba(30,24,50,0.93);
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    .fullscreen-modal.active { display: flex; }
    .fullscreen-img {
      max-width: 92vw;
      max-height: 82vh;
      border-radius: 14px;
      background: #fff;
      object-fit: contain;
      border: 2px solid var(--border);
    }
    .close-modal-btn {
      position: absolute;
      top: 32px;
      right: 48px;
      background: rgba(30,24,50,0.4);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 48px; height: 48px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 33px;
      z-index: 10001;
      transition: background 0.2s;
    }
    .close-modal-btn:hover {
      background: #7a3cff;
    }
    /* Sidebar (unchanged) */
    .sidebar {
      position: fixed;
      top: 62px;
      left: 0;
      width: 260px;
      background: var(--sidebar-bg);
      min-height: calc(100vh - 62px);
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      padding: 24px 10px 24px 10px;
      gap: 20px;
      border-right: 1px solid var(--border);
    }
    .sidebar .balance-tab {
      background: var(--surface);
      border-radius: 16px;
      padding: 17px 15px 13px 18px;
      min-width: 170px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
      border-left: 7px solid var(--accent);
      font-size: 16px;
      font-weight: 600;
      position: relative;
      margin-bottom: 0;
      transition: background 0.18s;
      cursor: pointer;
      outline: none;
      border-right: 3px solid transparent;
      border-bottom: 1px solid var(--border);
    }
    .balance-tab.selected, .sidebar .balance-tab.selected {
      border-right: 3px solid var(--primary);
      background: var(--card-bg);
    }
    .balance-tab.earnings {
      border-left: 7px solid var(--accent);
      background: #20312d;
    }
    .balance-tab.available {
      border-left: 7px solid var(--primary);
      background: var(--card-bg);
    }
    .balance-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 0px;
      letter-spacing: 0.2px;
    }
    .balance-label.available {
      color: var(--primary);
    }
    .balance-value {
      font-size: 18px;
      color: var(--text-main);
      font-weight: 500;
      letter-spacing: 0.2px;
      display: flex;
      align-items: baseline;
      gap: 2px;
      min-height: 20px;
      margin: 0;
      padding: 0;
      line-height: 1.1;
      width: 100%;
    }
    .balance-value span {
      font-size: 18px;
      font-weight: 500;
      margin-right: 3px;
    }
    .balance-value-eur {
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 400;
      margin-top: 1px;
      margin-left: 0;
      letter-spacing: 0.1px;
      line-height: 1.15em;
      display: block;
      width: 100%;
      word-break: break-word;
    }
    .sidebar .balance-tab .material-icons {
      font-size: 23px;
      margin-right: 6px;
      color: var(--accent);
    }
    .sidebar .balance-tab.available .material-icons {
      color: var(--primary);
    }
    @media (max-width: 1000px) {
      .sidebar {
        width: 100vw;
        min-height: unset;
        height: unset;
        position: static;
        flex-direction: row;
        padding: 8px 2vw;
        gap: 12px;
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
      .sidebar .balance-tab {
        min-width: 140px;
        max-width: 200px;
        margin: 0;
      }
      .main-content {
        margin-left: 0;
        padding-left: 0;
      }
      .seller-info-section, .order-section {
        margin-top: 80px;
      }
    }
    @media (max-width: 700px) {
      .sidebar {
        flex-direction: column;
        gap: 7px;
        padding: 4px 1vw;
      }
      .sidebar .balance-tab {
        min-width: unset;
        max-width: unset;
      }
      .main-content {
        margin-left: 0;
      }
      .seller-info-section, .order-section {
        padding-left: 10px;
        padding-right: 10px;
      }
      .seller-info-label, .order-label, .details-label {
        width: 120px;
        font-size: 15px;
      }
      .seller-info-value, .order-value, .details-value {
        font-size: 15px;
      }
    }
    @media (max-width: 500px) {
      .notification-dropdown {
        width: 98vw;
        left: 1vw;
        right: unset;
      }
      .seller-info-section, .order-section {
        padding-left: 5px;
        padding-right: 5px;
      }
    }
    ::-webkit-scrollbar {
      width: 8px;
      background: var(--background-light);
    }
    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 8px;
    }
    ::selection {
      background: #7a3cff66;
    }
    .price-value {
      background: var(--gradient-orange);
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: bold;
      display: inline-block;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="title">
      <span class="material-icons">precision_manufacturing</span>
      PakPortal
      <span class="exchange-rate"><span class="material-icons" style="font-size:18px;vertical-align:middle;">euro</span>1 PPC = 100 EUROS</span>
      <span class="notification-bell" id="notificationBell" title="Show updates" tabindex="0">
        <span class="material-icons" style="font-size:26px;">notifications</span>
        <span class="notification-badge" id="notificationBadge">0</span>
        <div class="notification-dropdown" id="notificationDropdown"></div>
      </span>
    </div>
    <div class="status-bar">
      <span title="Your Key" class="key-short" id="keyShort">
        <span class="material-icons">vpn_key</span>
        <span id="keyShortValue">---</span>
        <button class="delete-btn" title="Remove Key" id="deleteKeyBtn">
          <span class="material-icons">delete</span>
        </button>
      </span>
    </div>
  </div>
  <div class="sidebar" id="sidebarTabs">
    <div class="balance-tab" id="tab-potential" tabindex="0">
      <div class="balance-label"><span class="material-icons">trending_up</span>Potential Earnings</div>
      <div class="balance-value">
        <span id="potentialPPC">--</span> <span style="font-size:13px;font-weight:400;">PPC</span>
      </div>
      <span class="balance-value-eur" id="potentialEur">-- €</span>
    </div>
    <div class="balance-tab available selected" id="tab-available" tabindex="0">
      <div class="balance-label available"><span class="material-icons">account_balance_wallet</span>Earnings Available</div>
      <div class="balance-value">
        <span id="availablePPC">--</span> <span style="font-size:13px;font-weight:400;">PPC</span>
      </div>
      <span class="balance-value-eur" id="availableEur">-- €</span>
    </div>
    <div class="balance-tab" id="tab-withdrawn" tabindex="0">
      <div class="balance-label"><span class="material-icons">euro</span>Earnings Withdrawn</div>
      <div class="balance-value">
        <span id="withdrawnPPC">--</span> <span style="font-size:13px;font-weight:400;">PPC</span>
      </div>
      <span class="balance-value-eur" id="withdrawnEur">-- €</span>
    </div>
  </div>
  <div class="main-stack">
    <div class="seller-info-section">
      <div class="seller-info-title">
        <span class="material-icons">store</span>Seller Information
      </div>
      <table class="seller-info-table">
        <tr>
          <td class="seller-info-label"><span class="material-icons">business</span>Company Name:</td>
          <td class="seller-info-value">Acme Trading Ltd.</td>
        </tr>
        <tr>
          <td class="seller-info-label"><span class="material-icons">person</span>Contact Person:</td>
          <td class="seller-info-value">John Smith</td>
        </tr>
        <tr>
          <td class="seller-info-label"><span class="material-icons">mail</span>Email:</td>
          <td class="seller-info-value">john.smith@acmetrading.eu</td>
        </tr>
        <tr>
          <td class="seller-info-label"><span class="material-icons">call</span>Phone:</td>
          <td class="seller-info-value">+32 12 345 6789</td>
        </tr>
        <tr>
          <td class="seller-info-label"><span class="material-icons">account_balance</span>EU Account Number:</td>
          <td class="seller-info-value">BE88 1234 5678 9123</td>
        </tr>
        <tr>
          <td class="seller-info-label"><span class="material-icons">swap_horiz</span>SWIFT/BIC Code:</td>
          <td class="seller-info-value">DEUTBEBE</td>
        </tr>
        <tr>
          <td class="seller-info-label"><span class="material-icons">account_balance</span>Bank Name:</td>
          <td class="seller-info-value">Deutsche Bank Belgium</td>
        </tr>
        <tr>
          <td class="seller-info-label"><span class="material-icons">confirmation_number</span>EU VAT Number:</td>
          <td class="seller-info-value">BE0123.456.789</td>
        </tr>
        <tr>
          <td class="seller-info-label"><span class="material-icons">location_on</span>Company Address:</td>
          <td class="seller-info-value">123 Main Street, 1000 Brussels, Belgium</td>
        </tr>
      </table>
    </div>
    <div class="order-section">
      <div class="order-title">
        <span class="material-icons">shopping_cart</span>Order Details
      </div>
      <table class="order-table">
        <tr>
          <td class="order-label"><span class="material-icons">shopping_cart</span>Product</td>
          <td class="order-value">Mobile Recharge</td>
        </tr>
        <tr>
          <td class="order-label"><span class="material-icons">branding_watermark</span>Brand</td>
          <td class="order-value">Jazz Pakistan</td>
        </tr>
        <tr>
          <td class="order-label"><span class="material-icons">payments</span>Unit Price</td>
          <td class="order-value"><span class="price-value">1000 PPC</span></td>
        </tr>
        <tr>
          <td class="order-label"><span class="material-icons">stacked_line_chart</span>Quantity</td>
          <td class="order-value">1 Piece</td>
        </tr>
        <tr>
          <td class="order-label"><span class="material-icons">summarize</span>Total</td>
          <td class="order-value"><span class="price-value">1000 PPC</span></td>
        </tr>
      </table>
    </div>
    <div class="card-section">
      <div class="section-title"><span class="material-icons">info</span>Product Details</div>
      <table class="details-table">
        <tr>
          <td class="details-label"><span class="material-icons">shopping_cart</span>Product</td>
          <td class="details-value">Mobile Recharge</td>
        </tr>
        <tr>
          <td class="details-label"><span class="material-icons">payments</span>Price</td>
          <td class="details-value"><span class="price-value">1000 PPC</span></td>
        </tr>
        <tr>
          <td class="details-label"><span class="material-icons">branding_watermark</span>Brand</td>
          <td class="details-value">Jazz Pakistan</td>
        </tr>
        <tr>
          <td class="details-label"><span class="material-icons">description</span>Description</td>
          <td class="details-value">Prepaid mobile recharge for Jazz Pakistan numbers with instant topup delivery and support.</td>
        </tr>
        <tr>
          <td class="details-label" style="vertical-align:top;"><span class="material-icons">image</span>Images</td>
          <td class="details-value">
            <div class="images-row">
              <img class="product-image" src="https://res.cloudinary.com/de3kzkvhd/image/upload/v1749534470/2pXm5tQ_bynr4g.jpg" alt="Product Image 1">
              <img class="product-image" src="https://res.cloudinary.com/de3kzkvhd/image/upload/v1749534437/7iXvJCv_dggatx.jpg" alt="Product Image 2">
            </div>
          </td>
        </tr>
      </table>
    </div>
    <div class="card-section" style="background:var(--agreement-bg);border-left:7px solid var(--agreement-border);border:1px solid var(--agreement-border);">
      <div class="section-title agreement">
        <span class="material-icons agreement">fact_check</span>Agreement
      </div>
      <div class="agreement-list" id="agreementList">
        <div class="agreement-header">
          <div class="agreement-col-desc">Event</div>
          <div class="agreement-col-status">Status</div>
        </div>
      </div>
    </div>
  </div>
  <div class="fullscreen-modal" id="fullscreenModal">
    <button class="close-modal-btn" id="closeModalBtn" title="Close" type="button">
      <span class="material-icons">close</span>
    </button>
    <img class="fullscreen-img" id="fullscreenImg" src="" alt="Full Image">
  </div>
  <div class="modal-overlay" id="keyModalOverlay" style="display:none;">
    <div class="key-modal">
      <span class="material-icons" style="font-size:24px;">vpn_key</span>
      <label for="keyInput">Enter Your Polygon (Ethereum) Address:</label>
      <input type="text" id="keyInput" placeholder="0x...">
      <button id="saveKeyBtn">Save Key</button>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
  <script>
    // --- Notification logic ---
    const notifications = [
      { title: "Order Completed", description: "Your order #123 has been completed and PPC credited." },
      { title: "New Agreement", description: "A new agreement has been published for your review." },
      { title: "Withdrawal Processed", description: "500 PPC has been withdrawn and paid as 50,000 Euros." },
    ];
    function renderNotifications() {
      const list = document.getElementById('notificationDropdown');
      list.innerHTML = "";
      if (!notifications.length) {
        list.innerHTML = `<div class="notification-item"><span class="notification-title">No updates</span></div>`;
        return;
      }
      notifications.forEach(n => {
        const div = document.createElement("div");
        div.className = "notification-item";
        div.innerHTML = `<div class="notification-title">${n.title}</div>
        <div class="notification-desc">${n.description}</div>`;
        list.appendChild(div);
      });
    }
    function updateNotificationCount() {
      document.getElementById('notificationBadge').textContent = notifications.length;
      renderNotifications();
    }
    updateNotificationCount();

    // Bell open/close logic
    const bell = document.getElementById("notificationBell");
    const dropdown = document.getElementById("notificationDropdown");
    let notifOpen = false;
    function showNotifications() {
      dropdown.classList.add("visible");
      notifOpen = true;
    }
    function hideNotifications() {
      dropdown.classList.remove("visible");
      notifOpen = false;
    }
    bell.onclick = function(e) {
      notifOpen ? hideNotifications() : showNotifications();
      e.stopPropagation();
    };
    document.addEventListener("click", function(e){
      if (notifOpen && !bell.contains(e.target)) hideNotifications();
    });
    bell.addEventListener("keydown", function(e){
      if(e.key === "Enter" || e.key === " ") {
        bell.click();
      }
    });

    // --- Credits logic ---
    const DEMO_WALLETS = {
      potential: "0x53d284357ec70ce289d6d64134dfac8e511c8a3d",
      withdrawn: "0x53d284357ec70ce289d6d64134dfac8e511c8a3d"
    };
    const PPC_TO_EUR = 100;
    const NFTFAN_CA = "0x2017Fcaea540d2925430586DC92818035Bfc2F50";
    const ERC20_ABI = [
      {"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},
      {"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"type":"function"}
    ];
    const KEY_STORAGE = "PPC-key";
    const web3 = new Web3("https://polygon-rpc.com/");
    const nftfan = new web3.eth.Contract(ERC20_ABI, NFTFAN_CA);

    function shortKey(addr) {
      if (!addr) return "---";
      return addr.slice(0, 6) + "..." + addr.slice(-4);
    }
    function formatNumber(numStr, decimals) {
      if (!numStr) return "--";
      try {
        let n = BigInt(numStr);
        let div = BigInt(10) ** BigInt(decimals);
        let w = n / div;
        return w.toLocaleString('en-US');
      } catch {
        return "--";
      }
    }
    function formatEUR(ppc) {
      if (!ppc || isNaN(ppc.replace(/,/g,''))) return "--";
      let num = parseInt(ppc.replace(/,/g,''), 10);
      return (num * PPC_TO_EUR).toLocaleString('en-US') + " €";
    }
    function setTabBalance(tabPrefix, ppcStr) {
      document.getElementById(tabPrefix + "PPC").textContent = ppcStr;
      document.getElementById(tabPrefix + "Eur").textContent = (ppcStr !== "--") ? "≈ " + formatEUR(ppcStr) : "-- €";
    }
    async function fetchPPC(addr, tabPrefix) {
      try {
        const [bal, dec] = await Promise.all([
          nftfan.methods.balanceOf(addr).call(),
          nftfan.methods.decimals().call()
        ]);
        let balStr = formatNumber(bal, dec);
        setTabBalance(tabPrefix, balStr);
      } catch {
        setTabBalance(tabPrefix, "--");
      }
    }
    let currentTab = "available";
    function selectTab(tab) {
      document.querySelectorAll('.sidebar .balance-tab').forEach(t => t.classList.remove("selected"));
      document.getElementById('tab-' + tab).classList.add("selected");
      currentTab = tab;
      showCurrentTabBalance();
    }
    function showCurrentTabBalance() {
      if (currentTab === "available") {
        let addr = getStoredKey();
        if (addr && /^0x[a-fA-F0-9]{40}$/.test(addr)) {
          fetchPPC(addr, "available");
        } else {
          setTabBalance("available", "--");
        }
      } else if (currentTab === "potential") {
        fetchPPC(DEMO_WALLETS.potential, "potential");
      } else if (currentTab === "withdrawn") {
        fetchPPC(DEMO_WALLETS.withdrawn, "withdrawn");
      }
    }
    // --- Key logic ---
    function getStoredKey() {
      return localStorage.getItem(KEY_STORAGE);
    }
    function saveKey(addr) {
      localStorage.setItem(KEY_STORAGE, addr);
    }
    function afterKeySet(addr) {
      document.getElementById('keyShortValue').textContent = shortKey(addr);
      fetchPPC(addr, "available");
      document.body.classList.remove("blurred");
    }
    document.getElementById('deleteKeyBtn').onclick = function() {
      localStorage.removeItem(KEY_STORAGE);
      document.getElementById('keyShortValue').textContent = "---";
      showKeyModal();
    };
    document.getElementById('saveKeyBtn').onclick = function() {
      let addr = document.getElementById('keyInput').value.trim();
      if (!/^0x[a-fA-F0-9]{40}$/.test(addr)) {
        alert("Please enter a valid Polygon (Ethereum) address.");
        document.getElementById('keyInput').focus();
        return;
      }
      saveKey(addr);
      hideKeyModal();
      afterKeySet(addr);
    };
    document.getElementById('keyInput').addEventListener('keydown', function(e){
      if(e.key === "Enter") document.getElementById('saveKeyBtn').click();
    });
    function showKeyModal() {
      document.getElementById('keyModalOverlay').style.display = 'flex';
      document.body.classList.add("blurred");
      setTimeout(() => { document.getElementById('keyInput').focus(); }, 100);
    }
    function hideKeyModal() {
      document.getElementById('keyModalOverlay').style.display = 'none';
      document.body.classList.remove("blurred");
    }
    document.addEventListener("DOMContentLoaded", function() {
      // Tab click handlers
      document.getElementById("tab-potential").onclick = function() { selectTab("potential"); };
      document.getElementById("tab-available").onclick = function() { selectTab("available"); };
      document.getElementById("tab-withdrawn").onclick = function() { selectTab("withdrawn"); };
      // Fullscreen image modal logic
      var images = document.querySelectorAll('.product-image');
      images.forEach(function(img) {
        img.addEventListener('click', function(e) {
          e.preventDefault();
          showFullscreenImage(img.src);
        });
      });
      document.getElementById('closeModalBtn').onclick = closeFullscreenImage;
      document.getElementById('fullscreenModal').addEventListener('click', function(e) {
        if (e.target === this) closeFullscreenImage();
      });
      document.getElementById('keyModalOverlay').onclick = function(e) {
        if (e.target === this) return false;
      };
      // KEY logic
      let addr = getStoredKey();
      if (!addr || !/^0x[a-fA-F0-9]{40}$/.test(addr)) {
        showKeyModal();
      } else {
        afterKeySet(addr);
        fetchPPC(DEMO_WALLETS.potential, "potential");
        fetchPPC(DEMO_WALLETS.withdrawn, "withdrawn");
      }
      selectTab("available");
      setInterval(showCurrentTabBalance, 60000);

      // Agreement List logic
      const agreementEvents = [
        { icon: "check", text: "I agree to provide this product", status: "Done" },
        { icon: "local_shipping", text: "I can ship this product to the given address", status: "Done" },
        { icon: "build", text: "I will be responsible for shipping and repair", status: "Pending" },
        { icon: "update", text: "I will provide all updates to PakPortal", status: "Done" },
        { icon: "event_note", text: "I will keep all transaction records with PakPortal", status: "Pending" },
        { icon: "autorenew", text: "I will process orders promptly and professionally", status: "Done" },
        { icon: "assignment_turned_in", text: "I will follow PakPortal's terms and conditions", status: "Done" },
        { icon: "groups", text: "I will cooperate with PakPortal team for any support or clarification", status: "Pending" },
        { icon: "done_all", text: "I will ensure customer satisfaction and transparency", status: "Done" }
      ];
      const agreementList = document.getElementById("agreementList");
      agreementEvents.forEach(item => {
        const row = document.createElement('div');
        row.className = "agreement-item";
        row.innerHTML = `
          <div class="agreement-col-desc"><span class="material-icons">${item.icon}</span>${item.text}</div>
          <div class="agreement-col-status">
            <span class="agreement-status${item.status === "Done" ? " done" : ""}">
              ${item.status}
            </span>
          </div>
        `;
        agreementList.appendChild(row);
      });
    });
    function showFullscreenImage(src) {
      var modal = document.getElementById('fullscreenModal');
      var img = document.getElementById('fullscreenImg');
      img.src = src;
      modal.classList.add('active');
    }
    function closeFullscreenImage() {
      var modal = document.getElementById('fullscreenModal');
      modal.classList.remove('active');
      document.getElementById('fullscreenImg').src = "";
    }
  </script>
</body>
</html>
