<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DC Pole Studio - Exclusive Offer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { height: 100%; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f172a;
            color: #fff;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 198, 0.1) 0%, transparent 50%);
            overflow: hidden; /* Prevent scroll before expansion */
        }

        /* Initial Flyer State */
        .flyer-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000;
            cursor: pointer;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            width: 85%;
            max-width: 300px;
        }
        .main-flyer-img {
            width: 100%;
            border-radius: 12px;
            box-shadow: 0 20px 50px -10px rgba(0,0,0,0.5);
            transition: box-shadow 0.3s;
        }
        .expand-prompt {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: opacity 0.5s;
            white-space: nowrap;
        }
        
        /* Expanded Flyer State */
        .flyer-container.expanded {
            top: 90px;
            width: 35%;
            max-width: 120px;
            transform: translate(-50%, 0);
            cursor: pointer; /* Can be clicked again to open gallery */
        }
        .flyer-container.expanded .expand-prompt {
            opacity: 0;
            pointer-events: none;
        }
        
        .content-wrapper {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s 0.5s ease-out;
            padding-bottom: 100px;
        }
        .content-wrapper.visible {
            opacity: 1;
            pointer-events: auto;
        }

        /* Top Bar & Icons */
        .topbar {
            position: fixed; top: 0; left: 0; width: 100%; display: flex; align-items: center; z-index: 1010;
            background: linear-gradient(90deg, #6366f1, #ec4899, #10b981, #6366f1);
            background-size: 400% 400%; animation: huebar 10s linear infinite;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,0.14); padding: 5px 15px 5px 7px;
            font-weight: 600; color: #fff; opacity: 0; transition: opacity 0.5s 0.3s;
        }
        .topbar.visible { opacity: 0.97; }
        @keyframes huebar { 0% { background-position: 0% 50%;} 100% { background-position: 100% 50%;} }
        .topbar .bar-logo {
            width: 26px; height: 26px; border-radius: 8px; margin-right: 9px; background: #fff;
            box-shadow: 0 2px 8px #0001; display: flex; align-items: center; justify-content: center;
        }
        .topbar .bar-logo img { width: 100%; height: 100%; object-fit: contain; border-radius: 8px; }
        .topbar .bar-title { font-size: 12px; font-weight: 700; margin-right: 7px; letter-spacing: 0.4px; }
        .topbar .bar-offer {
            font-size: 11px; font-weight: 700; color: #f59e0b; background: #fff2; border-radius: 6px;
            padding: 2px 9px; margin-left: auto; letter-spacing: 0.5px; box-shadow: 0 1px 4px #fff2;
        }

        /* Icon Bar */
        .icon-bar {
            position: fixed; top: 36px; left: 0; width: 100%; display: flex; justify-content: space-around;
            align-items: center; padding: 8px 0; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px);
            z-index: 1009; border-bottom: 1px solid rgba(255, 255, 255, 0.1); opacity: 0; transition: opacity 0.5s 0.3s;
        }
        .icon-bar.visible { opacity: 1; }
        .icon-bar .icon-link { color: #e2e8f0; text-decoration: none; transition: color 0.3s, transform 0.3s; }
        .icon-bar .icon-link:hover { color: #ec4899; transform: scale(1.2); }
        .icon-bar .material-icons { font-size: 24px; }

        /* Notification Bar */
        .notification-bar {
            position: fixed; top: 80px; left: 50%; transform: translateX(-50%) translateY(-20px);
            max-width: 93vw; width: fit-content; display: flex; align-items: center; z-index: 1001;
            background: linear-gradient(90deg, #6366f1, #ec4899, #10b981, #6366f1); background-size: 400% 400%;
            animation: huebar 10s linear infinite; box-shadow: 0 2px 12px 0 rgba(0,0,0,0.11);
            border-radius: 14px; padding: 4px 18px 4px 10px; font-weight: 600; color: #fff;
            opacity: 0; pointer-events: none; transition: opacity 0.4s, transform 0.4s ease-out;
        }
        .notification-bar.show { opacity: 0.95; transform: translateX(-50%) translateY(0); pointer-events: auto; }
        .notification-bar .notif-title { font-size: 10px; font-weight: 700; margin-right: 7px; }
        .notification-bar .notif-message { font-size: 10px; font-weight: 500; margin-right: 7px; }
        .notification-close { background: none; color: #fff; border: none; font-size: 16px; cursor: pointer; opacity: 0.9; padding: 0 0 0 6px; }

        /* Fixed Promo Footer */
        .promo-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px 15px 15px 15px; z-index: 1000;
        }
        #promoForm { display: flex; gap: 8px; align-items: center; }
        .promo-input {
            flex-grow: 1; padding: 12px; font-size: 14px; font-weight: 600; background: rgba(255, 255, 255, 0.10);
            border: 1px solid rgba(255, 255, 255, 0.14); border-radius: 8px; color: #fff; outline: none;
            transition: all .2s; text-align: center; letter-spacing: 1px; text-transform: uppercase;
        }
        .promo-input::placeholder { color: #64748b; text-transform: none; letter-spacing: normal; font-size: 13px; }
        .promo-input:focus { border-color: #6366f1; background: rgba(99, 102, 241, 0.16); }
        .submit-button {
            padding: 12px 15px; font-size: 10px; font-weight: 700; background: linear-gradient(90deg, #6366f1 0%, #ec4899 100%);
            border: none; border-radius: 8px; color: #fff; cursor: pointer; transition: all .2s;
            text-transform: uppercase; letter-spacing: 0.3px; white-space: nowrap;
        }
        .submit-button:hover { box-shadow: 0 4px 12px -3px #6366f1aa; }
        .error-message {
            position: absolute; bottom: 100%; left: 0; width: 100%; color: #ef4444; font-size: 10px;
            text-align: center; padding: 8px; background: rgba(239, 68, 68, 0.2); display: none;
            animation: shake 0.4s ease-in-out;
        }
        @keyframes shake { 0%, 100% { transform: translateX(0);} 25% { transform: translateX(-4px);} 75% { transform: translateX(4px);} }

        /* Popup Styles */
        .popup-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(30, 41, 59, 0.86);
            backdrop-filter: blur(11px); z-index: 3000; display: none; opacity: 0; transition: opacity 0.3s;
        }
        .popup-overlay.show { display: flex; align-items: center; justify-content: center; opacity: 1; }
        .voucher-popup, .gallery-popup {
            width: 98vw; max-width: 340px; background: linear-gradient(135deg, #282a3a 0%, #353568 100%);
            color: #fff; border-radius: 18px; padding: 20px 11px 14px 11px; text-align: center;
            position: relative; box-shadow: 0 16px 32px -8px #0004, 0 2px 12px 0 #6366f11a;
            display: flex; flex-direction: column; align-items: center;
        }
        .close-btn {
            position: absolute; top: 8px; right: 8px; width: 26px; height: 26px; border: none;
            border-radius: 50%; background: linear-gradient(135deg, #ec4899 0%, #6366f1 100%);
            color: #fff; font-size: 15px; font-weight: 900; cursor: pointer; transition: all .2s;
            display: flex; align-items: center; justify-content: center; z-index: 10;
        }
        .close-btn:hover { transform: scale(1.09); }
        .popup-icon {
            width: 45px; height: 45px; background: linear-gradient(135deg, #6366f1 0%, #ec4899 100%);
            border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 9px;
            color: #fff; font-size: 22px;
        }
        .thanks-message { font-size: 15px; font-weight: 800; margin-bottom: 5px; }
        .info-text { font-size: 11px; color: #c7d2fe; margin-bottom: 10px; line-height: 1.45; }
        .voucher-img-popup {
            width: 80%; max-width: 142px; border-radius: 9px; object-fit: cover;
            border: 1.5px solid #a5b4fc; margin: 0 auto 7px auto; display: block;
        }
        .download-link { font-size: 10px; color: #a5b4fc; margin-bottom: 7px; display: inline-block; text-decoration: underline; }
        .popup-action-btns { display: flex; gap: 7px; justify-content: center; margin: 8px 0 9px 0; }
        .popup-action-btns .yesno-btn {
            flex: 1; padding: 9px 0; font-size: 11px; border: none; border-radius: 8px;
            font-weight: 700; cursor: pointer; transition: all .2s;
        }
        .popup-action-btns .yesno-btn.yes { background: linear-gradient(90deg, #10b981 0%, #6366f1 100%); color: #fff;}
        .popup-action-btns .yesno-btn.no { background: #475569; color: #f1f5f9;}
        .popup-form-group { margin: 9px 0 0 0; width:100%;}
        .popup-input {
            width: 100%; padding: 8px 9px; font-size: 11px; border-radius: 8px;
            border: 1.1px solid #a5b4fc; margin-bottom: 7px; background: #f5f6fa;
            color: #0f172a; outline: none; transition: all .2s;
        }
        .popup-error-message { color: #ef4444; font-size: 9px; min-height: 13px; }
        .share-email-btn {
            background: linear-gradient(90deg, #ec4899 0%, #6366f1 100%); color: #fff;
            border: none; border-radius: 8px; padding: 9px 0; font-weight: 700;
            font-size: 11px; margin-top: 2px; width: 100%; cursor: pointer; transition: all .2s;
        }
        .email-success-message { color: #10b981; font-size: 10.5px; font-weight: 700; }
        
        /* Gallery Popup */
        .gallery-popup .popup-title { font-size: 16px; font-weight: 700; margin-bottom: 15px; }
        .gallery-images { display: flex; flex-direction: column; gap: 10px; width: 100%; align-items: center;}
        .gallery-images .gallery-img { width: 100%; border-radius: 8px; }
        
        body.modal-open { overflow: hidden !important; }
    </style>
</head>
<body>
    <!-- Initially hidden content -->
    <div class="content-wrapper" id="contentWrapper">
        <div class="topbar" id="topbar">
            <span class="bar-logo"><img src="https://i.imgur.com/mvfRacN.png" alt="logo"></span>
            <span class="bar-title">DC Pole Studio</span>
            <span class="bar-offer">Exclusive Offer</span>
        </div>

        <div class="icon-bar" id="iconBar">
            <a href="https://dcpolestudio.com/" class="icon-link" title="Visit Website"><span class="material-icons">language</span></a>
            <a href="https://dashboard.mailerlite.com/forms/306260/79622216661075489/share" class="icon-link" title="Newsletter Signup"><span class="material-icons">mail</span></a>
            <a href="https://www.instagram.com/dcpole_leuven/?hl=en" class="icon-link" title="Follow on Instagram"><span class="material-icons">photo_camera</span></a>
            <a href="https://www.facebook.com/DCPOLE/" class="icon-link" title="Like on Facebook"><span class="material-icons">thumb_up</span></a>
            <a href="https://www.tripadvisor.com/Attraction_Review-g188669-d27734554-Reviews-Dc_Pole_Studio-Leuven_Flemish_Brabant_Province.html" class="icon-link" title="TripAdvisor Reviews"><span class="material-icons">rate_review</span></a>
        </div>

        <div class="notification-bar" id="notificationBar">
            <span class="notif-title">QR Code Scanned</span>
            <span class="notif-message">Welcome!</span>
            <button class="notification-close" type="button" id="notificationCloseBtn">&times;</button>
        </div>

        <div class="promo-footer">
            <form id="promoForm">
                <input type="text" id="promoCode" class="promo-input" placeholder="Enter Your Promo Code" required autocomplete="off">
                <button type="submit" class="submit-button" id="submitBtn"><span>Claim</span></button>
            </form>
            <div id="errorMessage" class="error-message"></div>
        </div>
    </div>

    <!-- The main flyer that is always visible at first -->
    <div class="flyer-container" id="flyerContainer">
        <img src="https://i.imgur.com/bM0aieT.jpeg" alt="Flyer" class="main-flyer-img" id="mainFlyerImg">
        <div class="expand-prompt" id="expandPrompt">Tap to Expand</div>
    </div>

    <!-- Voucher Result Popup -->
    <div class="popup-overlay" id="voucherPopupOverlay">
        <div class="voucher-popup">
            <button class="close-btn" type="button" id="closeVoucherBtn" title="Close">&times;</button>
            <div class="popup-icon" id="popupIcon">🎉</div>
            <div class="thanks-message" id="thanksMessage"></div>
            <div class="info-text" id="infoText"></div>
            <img src="https://i.imgur.com/JQWpLyT.png" alt="Voucher" class="voucher-img-popup" style="display:none;">
            <a class="download-link" href="https://i.imgur.com/JQWpLyT.png" target="_blank" style="display:none;">Download Voucher</a>
            <div class="popup-action-btns" id="popupActionBtns" style="display:none;">
                <button class="yesno-btn yes" id="yesBtn" type="button">Yes, Share Location</button>
                <button class="yesno-btn no" id="noBtn" type="button">No Thanks</button>
            </div>
            <form class="popup-form-group" id="emailForm" style="display:none;">
                <input type="email" id="emailInput" class="popup-input" placeholder="Enter your email" autocomplete="off" required>
                <div class="popup-error-message" id="emailError"></div>
                <button class="share-email-btn" type="submit">Get More Offers</button>
            </form>
            <div class="email-success-message" id="emailSuccessMsg" style="display:none;"></div>
        </div>
    </div>

    <!-- Gallery Popup -->
    <div class="popup-overlay" id="galleryPopupOverlay">
        <div class="gallery-popup">
            <button class="close-btn" type="button" id="closeGalleryBtn" title="Close">&times;</button>
            <div class="popup-title">Flyer Gallery</div>
            <div class="gallery-images">
                <img src="https://i.imgur.com/bM0aieT.jpeg" class="gallery-img" alt="Flyer Front">
                <img src="https://i.imgur.com/M8lRfnk.jpeg" class="gallery-img" alt="Flyer Back">
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD_c9jMxAA6dtyk_EXAHnH09OEAoalUADA",
            authDomain: "trackingclients.firebaseapp.com",
            projectId: "trackingclients",
            storageBucket: "trackingclients.appspot.com",
            messagingSenderId: "27490943622",
            appId: "1:27490943622:web:d6c87547aa5df440508707",
            databaseURL: "https://trackingclients-default-rtdb.firebaseio.com/"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const botToken = '7761334520:AAH2N1Ksa9NToLr6gd6DcknzpyB27q-_d14';
        const chatId = '2141064153';

        // --- DOM Elements ---
        const flyerContainer = document.getElementById('flyerContainer');
        const contentWrapper = document.getElementById('contentWrapper');
        const topbar = document.getElementById('topbar');
        const iconBar = document.getElementById('iconBar');
        const galleryPopupOverlay = document.getElementById('galleryPopupOverlay');
        const closeGalleryBtn = document.getElementById('closeGalleryBtn');
        const voucherPopupOverlay = document.getElementById('voucherPopupOverlay');
        const closeVoucherBtn = document.getElementById('closeVoucherBtn');
        const promoForm = document.getElementById('promoForm');
        const promoInput = document.getElementById('promoCode');
        const submitBtn = document.getElementById('submitBtn');
        const errorMessage = document.getElementById('errorMessage');
        const notificationBar = document.getElementById('notificationBar');
        const notificationCloseBtn = document.getElementById('notificationCloseBtn');
        
        let isExpanded = false;
        let lastPromoCode = 'DCPOLE10';
        let voucherShown = false;
        let locationAsked = false;

        // --- Expansion & Initial Load Logic ---
        flyerContainer.addEventListener('click', () => {
            if (!isExpanded) {
                flyerContainer.classList.add('expanded');
                contentWrapper.classList.add('visible');
                topbar.classList.add('visible');
                iconBar.classList.add('visible');
                isExpanded = true;
                document.body.style.overflow = 'auto'; // Allow scrolling

                // Trigger initial tracking and notification
                saveToFirebase('qr_scans', {
                    scanType: 'qr_expansion', timestamp: Date.now(), userAgent: navigator.userAgent
                });
                sendTelegramNotification('N/A', 'Flyer Expanded');
                
                setTimeout(() => {
                    notificationBar.classList.add('show');
                    setTimeout(() => {
                        if (notificationBar.classList.contains('show')) notificationBar.classList.remove('show');
                    }, 5000);
                }, 1000);
            } else {
                // If already expanded, clicking it opens the gallery
                galleryPopupOverlay.classList.add('show');
                setModalOpen(true);
            }
        });

        // --- Popups and Modal Logic ---
        function setModalOpen(open) { document.body.classList.toggle('modal-open', open); }
        function openVoucherPopup() { voucherPopupOverlay.classList.add('show'); setModalOpen(true); }
        function closeVoucherPopup() {
            voucherPopupOverlay.classList.remove('show');
            setModalOpen(false);
            setTimeout(() => { promoInput.value = ''; hideError(); voucherShown = false; locationAsked = false; }, 200);
        }
        function closeGalleryPopup() { galleryPopupOverlay.classList.remove('show'); setModalOpen(false); }

        closeVoucherBtn.addEventListener('click', closeVoucherPopup);
        closeGalleryBtn.addEventListener('click', closeGalleryPopup);
        voucherPopupOverlay.addEventListener('click', (e) => e.target === voucherPopupOverlay && closeVoucherPopup());
        galleryPopupOverlay.addEventListener('click', (e) => e.target === galleryPopupOverlay && closeGalleryPopup());
        notificationCloseBtn.addEventListener('click', () => notificationBar.classList.remove('show'));

        // --- Form and Validation Logic ---
        promoForm.addEventListener('submit', (e) => { e.preventDefault(); validatePromoCode(); });
        promoInput.addEventListener('input', () => { hideError(); promoInput.value = promoInput.value.toUpperCase(); });

        function validatePromoCode() {
            const code = promoInput.value.trim();
            if (!code) { showError('Please enter a promo code'); return; }
            showLoading(true);
            setTimeout(() => {
                if (code.toUpperCase() === 'DCPOLE10') {
                    hideError();
                    lastPromoCode = 'DCPOLE10';
                    showVoucherSuccess('Congratulations!', 'Here’s your exclusive voucher!<br><br>Would you like to share your location? This helps us provide better local offers.');
                } else {
                    showError('Invalid promo code. Please check and try again.');
                }
                showLoading(false);
            }, 900);
        }

        function showVoucherSuccess(title, message) {
            const voucherPopup = voucherPopupOverlay.querySelector('.voucher-popup');
            voucherPopup.querySelector('.thanks-message').innerHTML = title;
            voucherPopup.querySelector('.info-text').innerHTML = message;
            voucherPopup.querySelector('.popup-icon').textContent = '🎉';
            voucherPopup.querySelector('.voucher-img-popup').style.display = 'block';
            voucherPopup.querySelector('.download-link').style.display = 'inline-block';
            voucherPopup.querySelector('#popupActionBtns').style.display = 'flex';
            voucherPopup.querySelector('#emailForm').style.display = 'none';
            if (!voucherShown) createConfetti();
            voucherShown = true;
            openVoucherPopup();
            locationAsked = false;
        }

        function showError(message) { errorMessage.textContent = message; errorMessage.style.display = 'block'; }
        function hideError() { errorMessage.style.display = 'none'; }
        function showLoading(show) { submitBtn.disabled = show; submitBtn.style.opacity = show ? '0.7' : '1'; }

        // --- Location and Email Logic ---
        document.getElementById('yesBtn').onclick = function() {
            if (locationAsked) return;
            this.classList.add('loading');
            requestLocation(lastPromoCode);
            locationAsked = true;
        };
        document.getElementById('noBtn').onclick = function() {
            showAfterLocation('No Problem!', 'Here’s your voucher. Enjoy your discount!');
            sendTelegramNotification(lastPromoCode, 'Location sharing declined');
        };
        document.getElementById('emailForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const emailInput = document.getElementById('emailInput');
            const emailError = document.getElementById('emailError');
            const emailValue = emailInput.value.trim();
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailValue)) {
                emailError.textContent = "Please enter a valid email."; return;
            }
            sendTelegramNotification(lastPromoCode || 'DCPOLE10', 'Email Shared', emailValue);
            emailInput.value = '';
            emailError.textContent = '';
            document.getElementById('emailSuccessMsg').textContent = "Thank you! You'll receive our latest offers soon.";
            document.getElementById('emailSuccessMsg').style.display = 'block';
        });

        function showAfterLocation(title, message) {
            const voucherPopup = voucherPopupOverlay.querySelector('.voucher-popup');
            voucherPopup.querySelector('.thanks-message').innerHTML = title;
            voucherPopup.querySelector('.info-text').innerHTML = `${message}<br><br>Want more exclusive offers? Enter your email:`;
            voucherPopup.querySelector('#popupActionBtns').style.display = 'none';
            voucherPopup.querySelector('#emailForm').style.display = 'block';
        }

        function requestLocation(promoCode) {
            if (!navigator.geolocation) {
                showAfterLocation('Location Not Available', 'No worries! Here’s your voucher.');
                sendTelegramNotification(promoCode, 'Geolocation not supported');
                return;
            }
            navigator.geolocation.getCurrentPosition(
                pos => {
                    const { latitude: lat, longitude: lng, accuracy } = pos.coords;
                    const mapLink = `https://maps.google.com/?q=${lat},${lng}`;
                    saveToFirebase('locations', { lat, lng, accuracy, promoCode, timestamp: pos.timestamp, userAgent: navigator.userAgent });
                    showAfterLocation('Perfect! 🙏', 'Thank you for sharing. Here’s your voucher!');
                    sendTelegramNotification(promoCode, `[View on Map](${mapLink}) (Accuracy: ${Math.round(accuracy)}m)`);
                },
                err => {
                    showAfterLocation('No Problem!', 'Here’s your voucher. Enjoy!');
                    sendTelegramNotification(promoCode, `Location error: ${err.message}`);
                },
                { enableHighAccuracy: true, timeout: 15000, maximumAge: 60000 }
            );
        }

        // --- Utility Functions ---
        function saveToFirebase(collection, data) {
            const dataRef = ref(database, collection);
            set(push(dataRef), data);
        }

        function sendTelegramNotification(promoCode, action, email = null) {
            let message = `🎯 **Promo Action**\n\n**Action:** ${action}\n**Code:** \`${promoCode}\`\n**Time:** ${new Date().toLocaleString()}`;
            if (email) message += `\n**Email:** \`${email}\``;
            fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: chatId, text: message, parse_mode: 'Markdown' })
            });
        }

        function createConfetti() {
            const colors = ['#6366f1', '#8b5cf6', '#ec4899', '#10b981', '#f59e0b'];
            for (let i = 0; i < 32; i++) {
                const c = document.createElement('div');
                c.style.cssText = `position:fixed; width:8px; height:8px; background-color:${colors[Math.floor(Math.random()*colors.length)]}; left:${Math.random()*100}%; top:-10px; z-index:3100; border-radius:50%; pointer-events:none;`;
                document.body.appendChild(c);
                const anim = c.animate([
                    { transform: 'translateY(-10px) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight+10}px) rotate(360deg)`, opacity: 0 }
                ], { duration: Math.random()*1800+800, easing: 'cubic-bezier(0.25,0.46,0.45,0.94)' });
                anim.onfinish = () => c.remove();
            }
        }
    </script>
</body>
</html>
