<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>LeuvenFlyers â€” Campaign Dashboard</title>
    <meta name="color-scheme" content="light dark" />
    <style>
      /* ====== Design Tokens ====== */
      :root {
        --bg-primary: #0a0e17;
        --bg-secondary: #0d1322;
        --surface-1: #0f1628;
        --surface-2: #131b2e;
        --surface-3: #172237;

        --border-light: rgba(255, 255, 255, 0.08);
        --border-medium: rgba(255, 255, 255, 0.12);

        --text-primary: #f0f4f9;
        --text-secondary: #b0b8c7;
        --text-tertiary: #808d9f;

        --color-primary: #5b9cff;
        --color-primary-dark: #4a89e8;
        --color-accent: #6ea8ff;

        --color-success: #10b981;
        --color-warning: #f59e0b;
        --color-danger: #ef4444;
        --color-info: #3b82f6;

        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 20px;

        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
        --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.25);
        --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.3);

        --transition-fast: 150ms ease;
        --transition-normal: 250ms ease;
      }

      @media (prefers-color-scheme: light) {
        :root {
          --bg-primary: #f8fafc;
          --bg-secondary: #f1f5f9;
          --surface-1: #ffffff;
          --surface-2: #f8fafc;
          --surface-3: #f1f5f9;

          --border-light: rgba(15, 23, 42, 0.06);
          --border-medium: rgba(15, 23, 42, 0.1);

          --text-primary: #0f172a;
          --text-secondary: #475569;
          --text-tertiary: #64748b;

          --color-primary: #4f46e5;
          --color-primary-dark: #4338ca;
          --color-accent: #6366f1;

          --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
          --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
          --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
        }
      }

      /* ====== Base Styles ====== */
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        line-height: 1.6;
        letter-spacing: -0.01em;
      }

      .container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 24px;
      }

      /* ====== Header / Navigation ====== */
      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 32px;
        gap: 24px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .logo {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
        border-radius: var(--radius-lg);
        color: white;
        font-weight: 800;
        font-size: 18px;
        box-shadow: var(--shadow-md);
      }

      .logo-text {
        display: flex;
        flex-direction: column;
      }

      .logo-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
      }

      .logo-subtitle {
        font-size: 12px;
        color: var(--text-tertiary);
        font-weight: 500;
      }

      .header-actions {
        display: flex;
        gap: 10px;
      }

      .btn {
        appearance: none;
        border: none;
        border-radius: var(--radius-md);
        padding: 10px 16px;
        font-size: 13px;
        font-weight: 600;
        letter-spacing: 0.02em;
        cursor: pointer;
        transition: all var(--transition-fast);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        white-space: nowrap;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
        color: white;
        box-shadow: var(--shadow-sm);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: var(--surface-2);
        color: var(--text-primary);
        border: 1px solid var(--border-medium);
      }

      .btn-secondary:hover {
        background: var(--surface-3);
        border-color: var(--border-light);
      }

      /* ====== Page Title Section ====== */
      .page-title {
        margin-bottom: 32px;
      }

      .page-title h1 {
        margin: 0 0 8px 0;
        font-size: 32px;
        font-weight: 700;
        color: var(--text-primary);
      }

      .page-title p {
        margin: 0;
        font-size: 14px;
        color: var(--text-secondary);
      }

      .badges-row {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        flex-wrap: wrap;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        background: var(--surface-2);
        border: 1px solid var(--border-medium);
        border-radius: 999px;
        font-size: 12px;
        color: var(--text-secondary);
        font-weight: 600;
      }

      .badge-value {
        color: var(--text-primary);
        font-weight: 700;
      }

      /* ====== KPI Grid ====== */
      .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 16px;
        margin-bottom: 32px;
      }

      .kpi-card {
        background: var(--surface-1);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
        padding: 24px;
        box-shadow: var(--shadow-sm);
        transition: all var(--transition-normal);
      }

      .kpi-card:hover {
        border-color: var(--border-medium);
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
      }

      .kpi-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
      }

      .kpi-icon {
        font-size: 20px;
      }

      .kpi-label {
        font-size: 12px;
        color: var(--text-tertiary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .kpi-value {
        font-size: 32px;
        font-weight: 800;
        color: var(--text-primary);
        margin: 8px 0;
        letter-spacing: -0.02em;
      }

      .kpi-description {
        font-size: 12px;
        color: var(--text-tertiary);
      }

      .progress-bar {
        margin-top: 12px;
        height: 6px;
        background: var(--surface-2);
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid var(--border-light);
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-accent) 100%);
        width: var(--progress, 0%);
        transition: width 500ms ease;
        border-radius: 999px;
      }

      /* ====== Table Section ====== */
      .section {
        margin-bottom: 32px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 16px;
      }

      .table-container {
        background: var(--surface-1);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        overflow: hidden;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead th {
        padding: 16px;
        text-align: left;
        background: var(--surface-2);
        border-bottom: 1px solid var(--border-medium);
        font-size: 12px;
        font-weight: 700;
        color: var(--text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      tbody td {
        padding: 16px;
        border-bottom: 1px solid var(--border-light);
        font-size: 14px;
      }

      tbody tr:last-child td {
        border-bottom: none;
      }

      tbody tr {
        transition: background-color var(--transition-fast);
      }

      tbody tr:hover {
        background: var(--surface-2);
      }

      /* ====== Status Badges ====== */
      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        border: 1px solid transparent;
      }

      .status-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        flex-shrink: 0;
      }

      .status-completed {
        background: rgba(16, 185, 129, 0.1);
        color: var(--color-success);
        border-color: rgba(16, 185, 129, 0.2);
      }

      .status-completed .status-dot {
        background: var(--color-success);
      }

      .status-in-progress {
        background: rgba(95, 156, 255, 0.1);
        color: var(--color-primary);
        border-color: rgba(95, 156, 255, 0.2);
      }

      .status-in-progress .status-dot {
        background: var(--color-primary);
        animation: pulse 2s infinite;
      }

      .status-pending {
        background: rgba(245, 158, 11, 0.1);
        color: var(--color-warning);
        border-color: rgba(245, 158, 11, 0.2);
      }

      .status-pending .status-dot {
        background: var(--color-warning);
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      .note-text {
        color: var(--text-tertiary);
        text-align: right;
      }

      /* ====== Responsive ====== */
      @media (max-width: 768px) {
        .container {
          padding: 16px;
        }

        .header {
          flex-direction: column;
          align-items: flex-start;
          margin-bottom: 24px;
        }

        .header-actions {
          width: 100%;
        }

        .btn {
          flex: 1;
          justify-content: center;
        }

        .page-title h1 {
          font-size: 24px;
        }

        .kpi-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .kpi-card {
          padding: 16px;
        }

        .kpi-value {
          font-size: 24px;
        }

        thead {
          display: none;
        }

        tbody tr {
          display: block;
          background: var(--surface-2);
          border: 1px solid var(--border-medium);
          border-radius: var(--radius-md);
          padding: 16px;
          margin-bottom: 12px;
        }

        tbody td {
          display: block;
          padding: 8px 0;
          border-bottom: none;
          text-align: left;
        }

        tbody td::before {
          content: attr(data-label);
          display: block;
          font-size: 11px;
          font-weight: 700;
          color: var(--text-tertiary);
          text-transform: uppercase;
          letter-spacing: 0.05em;
          margin-bottom: 4px;
        }

        .note-text {
          text-align: left;
        }
      }

      /* ====== Focus & Accessibility ====== */
      :focus-visible {
        outline: 2px solid var(--color-primary);
        outline-offset: 2px;
      }

      /* ====== Utilities ====== */
      .right {
        text-align: right;
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <div class="logo">LF</div>
          <div class="logo-text">
            <div class="logo-title">LeuvenFlyers</div>
            <div class="logo-subtitle">Campaign Dashboard</div>
          </div>
        </div>
        <div class="header-actions">
          <a id="btnAllFlyers" class="btn btn-primary" href="#" target="_blank" rel="noopener">
            VIEW ALL FLYERS
          </a>
          <a id="btnAreas" class="btn btn-secondary" href="#" target="_blank" rel="noopener">
            VIEW DISTRIBUTION ZONES
          </a>
        </div>
      </div>

      <!-- Page Title -->
      <div class="page-title">
        <h1>Campaign Dashboard</h1>
        <p id="subtitle">Campaign XX995 â€¢ Track your campaign performance in real-time</p>
        <div class="badges-row">
          <span class="badge">
            <span>Campaign ID:</span>
            <span class="badge-value" id="pillCampaign">XX995</span>
          </span>
          <span class="badge">
            <span>Sector:</span>
            <span class="badge-value" id="sectorValue">Food</span>
          </span>
          <span class="badge" id="statusPill" style="display: none;">
            <span>Status:</span>
            <span class="badge-value" id="campaignStatus">â€”</span>
          </span>
        </div>
      </div>

      <!-- KPI Grid -->
      <div class="kpi-grid">
        <!-- Total Flyers -->
        <div class="kpi-card">
          <div class="kpi-header">
            <div class="kpi-icon">ðŸ“Š</div>
            <div class="kpi-label">Total Flyers</div>
          </div>
          <div class="kpi-value" id="totalFlyers">24,500</div>
          <div class="kpi-description">Total printed for campaign</div>
        </div>

        <!-- Flyers Distributed -->
        <div class="kpi-card">
          <div class="kpi-header">
            <div class="kpi-icon">ðŸ“¦</div>
            <div class="kpi-label">Distributed</div>
          </div>
          <div class="kpi-value" id="flyersDistributed">0</div>
          <div class="progress-bar">
            <div class="progress-fill" id="distributionBar" style="--progress: 0%"></div>
          </div>
          <div class="kpi-description"><span id="distributionPct">0%</span> of total distributed</div>
        </div>

        <!-- QR Code Scans -->
        <div class="kpi-card">
          <div class="kpi-header">
            <div class="kpi-icon">ðŸ“±</div>
            <div class="kpi-label">QR Scans</div>
          </div>
          <div class="kpi-value" id="qrScans">0</div>
          <div class="kpi-description">Unique scan events recorded</div>
        </div>
      </div>

      <!-- Milestones Table -->
      <div class="section">
        <h2 class="section-title">Campaign Milestones</h2>
        <div class="table-container">
          <table role="table" aria-label="Milestone status table">
            <thead>
              <tr>
                <th scope="col">Milestone</th>
                <th scope="col">Status</th>
                <th scope="col" class="right">Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td data-label="Milestone">Initial campaign planning</td>
                <td data-label="Status">
                  <span id="status-initial_planning" class="status-badge status-completed">
                    <span class="status-dot"></span> Completed
                  </span>
                </td>
                <td data-label="Notes" class="right note-text"><span id="note-initial_planning">Brief finalized</span></td>
              </tr>
              <tr>
                <td data-label="Milestone">Finding distributor</td>
                <td data-label="Status">
                  <span id="status-distributor" class="status-badge status-completed">
                    <span class="status-dot"></span> Completed
                  </span>
                </td>
                <td data-label="Notes" class="right note-text"><span id="note-distributor">Vendor confirmed</span></td>
              </tr>
              <tr>
                <td data-label="Milestone">Printing</td>
                <td data-label="Status">
                  <span id="status-printing" class="status-badge status-completed">
                    <span class="status-dot"></span> Completed
                  </span>
                </td>
                <td data-label="Notes" class="right note-text"><span id="note-printing">24.5k copies</span></td>
              </tr>
              <tr>
                <td data-label="Milestone">Flyer pick up</td>
                <td data-label="Status">
                  <span id="status-pickup" class="status-badge status-in-progress">
                    <span class="status-dot"></span> In Progress
                  </span>
                </td>
                <td data-label="Notes" class="right note-text"><span id="note-pickup">Scheduled</span></td>
              </tr>
              <tr>
                <td data-label="Milestone">Flyer distribution</td>
                <td data-label="Status">
                  <span id="status-distribution" class="status-badge status-pending">
                    <span class="status-dot"></span> Pending
                  </span>
                </td>
                <td data-label="Notes" class="right note-text"><span id="note-distribution">0% complete</span></td>
              </tr>
              <tr>
                <td data-label="Milestone">Payment</td>
                <td data-label="Status">
                  <span id="status-payment" class="status-badge status-pending">
                    <span class="status-dot"></span> Pending
                  </span>
                </td>
                <td data-label="Notes" class="right note-text"><span id="note-payment">Due on completion</span></td>
              </tr>
              <tr>
                <td data-label="Milestone">Feedback</td>
                <td data-label="Status">
                  <span id="status-feedback" class="status-badge status-pending">
                    <span class="status-dot"></span> Pending
                  </span>
                </td>
                <td data-label="Notes" class="right note-text"><span id="note-feedback">Awaiting scan uplift</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Firebase Module -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyD_c9jMxAA6dtyk_EXAHnH09OEAoalUADA",
        authDomain: "trackingclients.firebaseapp.com",
        projectId: "trackingclients",
        storageBucket: "trackingclients.appspot.com",
        messagingSenderId: "27490943622",
        appId: "1:27490943622:web:d6c87547aa5df440508707",
        databaseURL: "https://trackingclients-default-rtdb.firebaseio.com/"
      };

      const CAMPAIGN_ID = "XX995";

      // DOM Elements
      const totalEl = document.getElementById("totalFlyers");
      const distEl = document.getElementById("flyersDistributed");
      const barEl = document.getElementById("distributionBar");
      const pctEl = document.getElementById("distributionPct");
      const qrEl = document.getElementById("qrScans");
      const sectorEl = document.getElementById("sectorValue");
      const campaignStatusEl = document.getElementById("campaignStatus");
      const statusPill = document.getElementById("statusPill");
      const subtitleEl = document.getElementById("subtitle");
      const pillCampaign = document.getElementById("pillCampaign");
      const btnAllFlyers = document.getElementById("btnAllFlyers");
      const btnAreas = document.getElementById("btnAreas");

      const STEP_KEYS = [
        "initial_planning",
        "distributor",
        "printing",
        "pickup",
        "distribution",
        "payment",
        "feedback"
      ];

      let totalFlyers = 24500;
      let distributedLatest = 0;

      const app = initializeApp(firebaseConfig, "campaignAppDashboard");
      const db = getDatabase(app);

      const toInt = (v) => {
        if (v === null || v === undefined) return 0;
        const n = Number(v);
        return Number.isFinite(n) ? n : parseInt(String(v).replace(/[^\d.-]/g, ""), 10) || 0;
      };

      function setProgress() {
        const pct = totalFlyers > 0 ? (distributedLatest / totalFlyers) * 100 : 0;
        const pctClamped = Math.max(0, Math.min(100, pct));
        if (barEl) barEl.style.setProperty("--progress", pctClamped.toFixed(1) + "%");
        if (pctEl) pctEl.textContent = Math.round(pctClamped) + "%";

        const badge = document.getElementById("status-distribution");
        const note = document.getElementById("note-distribution");
        if (badge) {
          badge.classList.remove("status-pending", "status-in-progress", "status-completed");
          if (pctClamped >= 100) {
            badge.classList.add("status-completed");
            badge.setAttribute("aria-label", "Completed");
            badge.innerHTML = '<span class="status-dot"></span> Completed';
          } else if (pctClamped <= 0) {
            badge.classList.add("status-pending");
            badge.setAttribute("aria-label", "Pending");
            badge.innerHTML = '<span class="status-dot"></span> Pending';
          } else {
            badge.classList.add("status-in-progress");
            badge.setAttribute("aria-label", "In Progress");
            badge.innerHTML = '<span class="status-dot"></span> In Progress';
          }
        }
        if (note) note.textContent = `${Math.round(pctClamped)}% complete`;
      }

      function statusToClass(status) {
        if (status === "completed") return "status-completed";
        if (status === "in_progress") return "status-in-progress";
        return "status-pending";
      }

      function statusToLabel(status) {
        if (status === "completed") return "Completed";
        if (status === "in_progress") return "In Progress";
        return "Pending";
      }

      function setBadge(id, statusValue) {
        const el = document.getElementById(id);
        if (!el) return;
        const cls = statusToClass(statusValue);
        el.className = `status-badge ${cls}`;
        el.setAttribute("aria-label", statusToLabel(statusValue));
        el.innerHTML = `<span class="status-dot"></span> ${statusToLabel(statusValue)}`;
      }

      function setNote(id, text) {
        const el = document.getElementById(id);
        if (!el) return;
        el.textContent = text || "";
      }

      function setTotalFlyersUI(val) {
        totalFlyers = Math.max(0, toInt(val));
        totalEl.textContent = totalFlyers.toLocaleString();
        setProgress();
      }

      function setCtaLinksFromId(id) {
        const digits = (id.match(/\d+/) || [""])[0];
        const suffix = digits || id.toLowerCase();
        const flyersUrl = `https://leuvenflyers.com/ff${suffix}`;
        const areasUrl = `https://leuvenflyers.com/xx${suffix}`;
        if (btnAllFlyers) btnAllFlyers.href = flyersUrl;
        if (btnAreas) btnAreas.href = areasUrl;
      }

      setCtaLinksFromId(CAMPAIGN_ID);

      // Live data listeners
      onValue(ref(db, `campaigns/${CAMPAIGN_ID}/meta`), (snap) => {
        const meta = snap.val() || {};
        if (meta.totalFlyers != null) setTotalFlyersUI(meta.totalFlyers);
        if (meta.sector) sectorEl.textContent = meta.sector;
        if (meta.status) {
          statusPill.style.display = "inline-flex";
          campaignStatusEl.textContent = meta.status.replace(/_/g, " ");
          subtitleEl.textContent = `Campaign ${CAMPAIGN_ID} â€¢ ${meta.status.replace(/_/g, " ").toUpperCase()}`;
        } else {
          statusPill.style.display = "none";
          subtitleEl.textContent = `Campaign ${CAMPAIGN_ID} â€¢ Track your campaign performance in real-time`;
        }
        pillCampaign.textContent = CAMPAIGN_ID;
        setCtaLinksFromId(CAMPAIGN_ID);
      }, (err) => console.error("Failed to read meta", err));

      onValue(ref(db, `campaigns/${CAMPAIGN_ID}/steps`), (snap) => {
        const steps = snap.val() || {};
        STEP_KEYS.forEach((k) => {
          const s = steps[k] || {};
          setBadge(`status-${k}`, s.status || "pending");
          setNote(`note-${k}`, s.note || "");
        });
      }, (err) => console.error("Failed to read steps", err));

      onValue(ref(db, `campaigns/${CAMPAIGN_ID}/zone_statuses`), (snap) => {
        let distributed = 0;
        if (snap.exists()) {
          snap.forEach((child) => {
            const z = child.val() || {};
            if (z.status === "completed") {
              distributed += toInt(z.flyers);
            }
          });
        }
        distributedLatest = distributed;
        distEl.textContent = distributed.toLocaleString();
        setProgress();
      }, (err) => {
        console.error("Failed to read zone_statuses", err);
        distEl.textContent = "0";
        distributedLatest = 0;
        setProgress();
      });

      onValue(ref(db, "qr_scans"), (snap) => {
        let count = 0;
        if (snap.exists()) {
          const val = snap.val() || {};
          for (const k in val) {
            const s = val[k];
            if (s && s.promoCode === CAMPAIGN_ID) count++;
          }
        }
        const qrElLocal = document.getElementById("qrScans");
        if (qrElLocal) qrElLocal.textContent = count.toLocaleString();
      }, (err) => {
        console.error("Failed to read qr_scans", err);
        const qrElLocal = document.getElementById("qrScans");
        if (qrElLocal) qrElLocal.textContent = "0";
      });

      setTotalFlyersUI(totalFlyers);
    </script>
  </body>
</html>
