<!DOCTYPE html>
<html lang="en">
<head>
  <title>PakPortal</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --primary: #7a3cff;
      --accent: #ffd600;
      --success: #36c177;
      --pending: #ffb300;
      --danger: #e53935;
      --surface: #23273a;
      --surface2: #22263a;
      --surface3: #181a24;
      --border: #312b47;
      --border-light: #3f3b5b;
      --text: #eee;
      --text-light: #bcb9d2;
      --text-faded: #8d8bae;
      --topbar-h: 48px;
      --footer-h: 38px;
      --card-radius: 20px;
      --shadow: rgba(0,0,0,0.08);
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-size: 13px;
      font-family: 'Roboto', 'Arial', sans-serif;
      background: var(--surface3);
      color: var(--text);
      box-sizing: border-box;
      overflow: hidden;
    }
    #root-app-layout {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow: hidden;
    }
    .top-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--topbar-h);
      z-index: 100;
      background: var(--surface2);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 14px;
      font-weight: 400;
      padding: 0 12px 0 32px;
      border-bottom: 1px solid var(--border-light);
      box-shadow: 0 2px 10px var(--shadow);
    }
    .footer-bar {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      height: var(--footer-h);
      background: var(--surface2);
      color: var(--text-faded);
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-top: 1px solid var(--border-light);
      z-index: 100;
      letter-spacing: 0.2em;
    }
    .main-app-body {
      display: flex;
      flex-direction: column;
      flex: 1 1 auto;
      width: 100vw;
      height: 100vh;
      margin-top: var(--topbar-h);
      margin-bottom: var(--footer-h);
      overflow: auto;
      align-items: center;
      background: none;
    }
    .info-banner {
      background: #231e36;
      color: var(--accent);
      font-size: 15px;
      font-weight: 500;
      padding: 24px 22px 8px 22px;
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      text-align: left;
      border-radius: 0 0 14px 14px;
      box-sizing: border-box;
      line-height: 1.7em;
      letter-spacing: 0.01em;
    }
    .info-banner a {
      color: var(--primary);
      text-decoration: underline;
      word-break: break-all;
    }
    .tabs-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0;
      margin: 16px auto 0 auto;
      background: var(--surface2);
      border-radius: 14px 14px 0 0;
      box-shadow: 0 4px 32px #1a183040;
      width: 100%;
      max-width: 520px;
      position: relative;
      z-index: 2;
    }
    .tab-btn {
      flex: 1 1 0;
      padding: 16px 0 12px 0;
      border: none;
      background: none;
      color: var(--text-faded);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.18s;
      outline: none;
      letter-spacing: 0.1em;
      border-radius: 14px 14px 0 0;
      position: relative;
    }
    .tab-btn.active {
      color: var(--primary);
      background: var(--surface3);
      border-bottom: 3px solid var(--primary);
    }
    .tab-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--danger);
      color: #fff;
      font-size: 13px;
      font-weight: 700;
      border-radius: 50%;
      min-width: 22px;
      height: 22px;
      padding: 0 7px;
      margin-left: 8px;
      vertical-align: middle;
      box-shadow: 0 2px 6px #0003;
      border: 2px solid var(--surface2);
      position: relative;
      top: -2px;
      letter-spacing: 0.02em;
      transition: background 0.2s;
      line-height: 1;
    }
    .tab-content {
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      display: none;
      background: none;
    }
    .tab-content.active { display: block; }
    /* Form Card */
    .form-card {
      background: var(--surface2);
      border-radius: var(--card-radius);
      padding: 32px 24px 18px 24px;
      margin: 36px auto 0 auto;
      box-shadow: 0 4px 32px #1a183040;
      border: 1.5px solid var(--border);
      width: 100%;
      max-width: 640px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .form-title {
      font-size: 20px;
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 8px;
      letter-spacing: 0.07em;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .form-title .material-icons {
      font-size: 22px;
      vertical-align: middle;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .form-group label {
      color: var(--text-faded);
      font-size: 13.5px;
      font-weight: 500;
      margin-bottom: 2px;
      letter-spacing: 0.07em;
    }
    .form-group input, .form-group textarea {
      background: var(--surface3);
      color: var(--text);
      border: 1.2px solid var(--border-light);
      border-radius: 8px;
      font-size: 15px;
      padding: 8px 12px;
      margin-bottom: 0;
      outline: none;
      transition: border 0.2s, background 0.2s;
      font-family: 'Roboto', 'Arial', sans-serif;
      resize: none;
    }
    .form-group input:focus, .form-group textarea:focus {
      border: 1.5px solid var(--primary);
    }
    .form-group textarea {
      min-height: 110px;
      max-height: 350px;
      font-size: 16px;
      padding: 14px 14px;
      width: 100%;
      box-sizing: border-box;
    }
    .submit-btn {
      margin-top: 12px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 11px 0;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      letter-spacing: 0.08em;
      box-shadow: 0 2px 10px #0001;
      transition: background 0.18s;
    }
    .submit-btn:hover { background: #a28fff; }
    /* Requests Beautiful Card List */
    .requests-cards-list-section {
      margin: 36px auto 0 auto;
      width: 100%;
      max-width: 700px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
    }
    .request-beautiful-card {
      background: #1e1935;
      border-radius: 14px;
      margin-bottom: 0;
      padding: 20px 22px 14px 20px;
      border: 1.5px solid var(--border-light);
      box-shadow: 0 2px 10px #0002;
      display: flex;
      flex-direction: column;
      gap: 6px;
      width: 100%;
      max-width: 680px;
      position: relative;
      transition: background 0.19s;
    }
    .request-beautiful-card .request-id-badge {
      position: absolute;
      top: 12px;
      right: 18px;
      background: var(--danger);
      color: #fff;
      font-size: 13px;
      font-weight: 700;
      padding: 5px 14px 5px 10px;
      border-radius: 20px;
      letter-spacing: 0.08em;
      box-shadow: 0 2px 8px #0002;
      display: flex;
      align-items: center;
      gap: 6px;
      z-index: 2;
      border: 1.5px solid var(--border-light);
    }
    .request-beautiful-card .request-id-badge span {
      font-weight: 700;
      font-size: 13px;
      letter-spacing: 0.08em;
    }
    .request-beautiful-card .card-header-row {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 0;
      flex-wrap: wrap;
      font-size: 15px;
    }
    .request-beautiful-card .requestor-chip {
      background: #2d2351;
      color: var(--primary);
      font-size: 14px;
      border-radius: 5px;
      padding: 2px 12px 2px 9px;
      font-weight: 500;
      border: 1px solid var(--border-light);
      min-width: 85px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .request-beautiful-card .company-chip {
      background: #272a41;
      color: var(--accent);
      font-size: 14px;
      border-radius: 5px;
      padding: 2px 12px 2px 9px;
      font-weight: 500;
      border: 1px solid var(--border-light);
      min-width: 70px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .request-beautiful-card .card-title-row {
      display: flex;
      align-items: center;
      gap: 7px;
      flex-wrap: wrap;
      font-size: 15.5px;
      font-weight: 700;
      color: var(--primary);
      letter-spacing: 0.03em;
      word-break: break-word;
      max-width: 100%;
      text-shadow: 0 2px 10px #0002;
      padding-right: 8px;
      margin-bottom: 4px;
      margin-top: 2px;
    }
    .request-beautiful-card .card-title {
      font-size: 15.5px;
      font-weight: 700;
      color: var(--primary);
      letter-spacing: 0.03em;
      flex: 1 1 140px;
      word-break: break-word;
      max-width: 100%;
      text-shadow: 0 2px 10px #0002;
      padding-right: 8px;
    }
    .request-beautiful-card .card-divider {
      border: none;
      border-top: 1px solid var(--border-light);
      margin: 10px 0 7px 0;
      width: 100%;
      opacity: 0.5;
    }
    .request-beautiful-card .card-details-row {
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 2px;
    }
    .request-beautiful-card .detail-label {
      font-weight: 600;
      color: var(--primary);
      margin-right: 3px;
      font-size: 13px;
    }
    .request-beautiful-card .card-specs {
      font-size: 15px;
      color: var(--text-light);
      padding: 6px 0 0 2px;
      margin-bottom: 0;
      letter-spacing: 0.01em;
      line-height: 1.6em;
      word-break: break-word;
      white-space: pre-line;
    }
    .empty-notice {
      margin: 40px 0 0 0;
      color: var(--text-faded);
      font-size: 16px;
      text-align: center;
      letter-spacing: 0.04em;
    }
    @media (max-width: 900px) {
      .tab-content,
      .form-card,
      .requests-cards-list-section,
      .request-beautiful-card { max-width: 99vw; }
      .form-group textarea { min-height: 90px; }
      .info-banner { max-width: 99vw; }
    }
  </style>
</head>
<body>
<div id="root-app-layout">
  <div class="top-bar">
    <div class="title">
      <span class="material-icons" style="font-size:20px;">precision_manufacturing</span>
      PakPortal
    </div>
    <div></div>
  </div>
  <div class="main-app-body">
    <div class="info-banner">
      For more information and questions contact us <a href="mailto:pakportal@europe.com">pakportal@europe.com</a><br>
      Your request will be added to "requested products" on <a href="https://www.leuvenflyers.com/pph/" target="_blank">https://www.leuvenflyers.com/pph/</a>
    </div>
    <div class="tabs-row" id="tabsRow">
      <button class="tab-btn active" data-tab="request-form" id="tabRequestFormBtn">
        <span class="material-icons" style="font-size:18px;vertical-align:middle;">add_circle</span> Request Form
      </button>
      <button class="tab-btn" data-tab="requests-list" id="tabRequestsListBtn">
        <span class="material-icons" style="font-size:18px;vertical-align:middle;">assignment</span>
        Submitted Requests
        <span class="tab-badge" id="requestsTabBadge">0</span>
      </button>
    </div>
    <div class="tab-content active" id="requestFormTab">
      <form class="form-card" id="productRequestForm" autocomplete="off">
        <div class="form-title">
          <span class="material-icons">add_circle</span> Request a product from PakPortal
        </div>
        <div class="form-group">
          <label for="requestorName">Requestor Name</label>
          <input type="text" id="requestorName" name="requestorName" required maxlength="60" autocomplete="name" />
        </div>
        <div class="form-group">
          <label for="contactEmail">Contact Email</label>
          <input type="email" id="contactEmail" name="contactEmail" required maxlength="80" autocomplete="email"/>
        </div>
        <div class="form-group">
          <label for="companyName">Company Name</label>
          <input type="text" id="companyName" name="companyName" required maxlength="70" autocomplete="organization"/>
        </div>
        <div class="form-group">
          <label for="productDetails">Product Details<br>
            <span style="color:var(--text-faded);font-size:12px;font-weight:400;">
              (Enter Product Name, Brand, Specifications, Quantity, or any other detail in one box)
            </span>
          </label>
          <textarea id="productDetails" name="productDetails" required maxlength="700" placeholder="e.g. Brand: Jazz, Product: Mobile Recharge, Quantity: 10, Model: XYZ, Specs: ..."></textarea>
        </div>
        <button class="submit-btn" type="submit">Submit Request</button>
      </form>
    </div>
    <div class="tab-content" id="requestsListTab">
      <div class="requests-cards-list-section" id="requestsCardsSection">
        <div class="empty-notice" id="emptyNotice">No requests submitted yet.</div>
      </div>
    </div>
  </div>
  <div class="footer-bar">
    Copyright PakPortal 2025
  </div>
</div>
<script>
const PANTRY_URL = "https://getpantry.cloud/apiv1/pantry/20d841d1-e6e5-442e-aebc-70c2152b1a01/basket/newBasket22";
const REQUESTS_KEY = "requests"; // single key in basket

function generateRequestId() {
  const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
  let id = "";
  for (let i = 0; i < 7; ++i) id += chars[Math.floor(Math.random() * chars.length)];
  return id;
}
function escapeHTML(str) {
  if (!str) return "";
  return str.replace(/[&<>"']/g, m => ({
    '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
  })[m]);
}

let requestsCache = [];

function updateRequestsTabBadge() {
  const badge = document.getElementById('requestsTabBadge');
  badge.textContent = requestsCache.length > 99 ? "99+" : requestsCache.length;
}

async function fetchRequestsFromPantry() {
  try {
    const res = await fetch(PANTRY_URL);
    const data = await res.json();
    requestsCache = Array.isArray(data[REQUESTS_KEY]) ? data[REQUESTS_KEY] : [];
  } catch {
    requestsCache = [];
  }
  updateRequestsTabBadge();
}

async function addRequestToPantry(request) {
  await fetchRequestsFromPantry();
  requestsCache.unshift(request);
  // Limit to last 100 for performance if needed
  if (requestsCache.length > 100) requestsCache = requestsCache.slice(0, 100);
  await fetch(PANTRY_URL, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ [REQUESTS_KEY]: requestsCache })
  });
  updateRequestsTabBadge();
}

function renderRequestsCards() {
  const section = document.getElementById('requestsCardsSection');
  const emptyNotice = document.getElementById('emptyNotice');
  Array.from(section.querySelectorAll('.request-beautiful-card')).forEach(e => e.remove());
  if (!requestsCache.length) {
    emptyNotice.style.display = 'block';
    return;
  }
  emptyNotice.style.display = 'none';
  requestsCache.forEach(req => {
    const card = document.createElement('div');
    card.className = "request-beautiful-card";
    // Request ID badge
    const idBadge = document.createElement('div');
    idBadge.className = "request-id-badge";
    idBadge.innerHTML = `<span>Request ID:</span> <span>${escapeHTML(req.requestId || "--------")}</span>`;
    card.appendChild(idBadge);
    // Header row
    const headerRow = document.createElement('div');
    headerRow.className = "card-header-row";
    headerRow.innerHTML = `
      <span class="requestor-chip">
        <span class="material-icons" style="font-size:17px;vertical-align:middle;">person</span>
        <span><strong>Requestor:</strong> ${escapeHTML(req.requestorName)}</span>
      </span>
      <span class="company-chip">
        <span class="material-icons" style="font-size:17px;vertical-align:middle;">corporate_fare</span>
        <span><strong>Company:</strong> ${escapeHTML(req.companyName)}</span>
      </span>
    `;
    card.appendChild(headerRow);
    // Divider
    const divider = document.createElement('hr');
    divider.className = "card-divider";
    card.appendChild(divider);
    // Details row: Email
    const detailsRow = document.createElement('div');
    detailsRow.className = "card-details-row";
    detailsRow.innerHTML = `
      <span><span class="detail-label"><span class="material-icons" style="font-size:14px;vertical-align:middle;">email</span> Email:</span> ${escapeHTML(req.contactEmail)}</span>
    `;
    card.appendChild(detailsRow);
    // Details row: Timestamp
    if (req.timestamp) {
      const date = new Date(req.timestamp);
      const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
      const timeRow = document.createElement('div');
      timeRow.className = "card-details-row";
      timeRow.innerHTML = `<span><span class="detail-label"><span class="material-icons" style="font-size:14px;vertical-align:middle;">event</span> Submitted:</span> ${escapeHTML(dateStr)}</span>`;
      card.appendChild(timeRow);
    }
    // Divider
    const divider2 = document.createElement('hr');
    divider2.className = "card-divider";
    card.appendChild(divider2);
    // Product details
    if (req.productDetails) {
      const desc = document.createElement('div');
      desc.className = "card-specs";
      desc.innerHTML = `<span class="detail-label"><span class="material-icons" style="font-size:14px;vertical-align:middle;">description</span> Product Details:</span><br>${escapeHTML(req.productDetails)}`;
      card.appendChild(desc);
    }
    section.appendChild(card);
  });
}

// Tab logic
document.getElementById('tabRequestFormBtn').onclick = function() {
  this.classList.add('active');
  document.getElementById('tabRequestsListBtn').classList.remove('active');
  document.getElementById('requestFormTab').classList.add('active');
  document.getElementById('requestsListTab').classList.remove('active');
};
document.getElementById('tabRequestsListBtn').onclick = async function() {
  this.classList.add('active');
  document.getElementById('tabRequestFormBtn').classList.remove('active');
  document.getElementById('requestsListTab').classList.add('active');
  document.getElementById('requestFormTab').classList.remove('active');
  await fetchRequestsFromPantry();
  renderRequestsCards();
};

document.getElementById('productRequestForm').onsubmit = async function(e) {
  e.preventDefault();
  const request = {
    requestorName: document.getElementById('requestorName').value.trim(),
    contactEmail: document.getElementById('contactEmail').value.trim(),
    companyName: document.getElementById('companyName').value.trim(),
    productDetails: document.getElementById('productDetails').value.trim(),
    timestamp: Date.now(),
    requestId: generateRequestId()
  };
  await addRequestToPantry(request);
  document.getElementById('productRequestForm').reset();
  document.getElementById('tabRequestsListBtn').click();
  await fetchRequestsFromPantry();
  renderRequestsCards();
};

async function initialLoad() {
  document.getElementById('productRequestForm').reset();
  await fetchRequestsFromPantry();
  renderRequestsCards();
}
document.addEventListener("DOMContentLoaded", initialLoad);
</script>
</body>
</html>
