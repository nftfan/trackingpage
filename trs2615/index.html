<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <style>
        body {
            background: #ffffff;
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD_c9jMxAA6dtyk_EXAHnH09OEAoalUADA",
            authDomain: "trackingclients.firebaseapp.com",
            projectId: "trackingclients",
            storageBucket: "trackingclients.appspot.com",
            messagingSenderId: "27490943622",
            appId: "1:27490943622:web:d6c87547aa5df440508707",
            databaseURL: "https://trackingclients-default-rtdb.firebaseio.com/"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Function to perform redirect
        const doRedirect = () => {
            window.location.replace("https://cap-sud.com/");
        };

        // Save to Firebase with a promise wrapper
        const saveAndRedirect = () => {
            const dataRef = ref(database, 'qr_scans');
            const newDataRef = push(dataRef);
            
            set(newDataRef, {
                scanType: 'visit_link_page', 
                timestamp: Date.now(), 
                userAgent: navigator.userAgent, 
                promoCode: 'XX2615'
            })
            .then(() => {
                console.log("Recorded successfully");
                doRedirect();
            })
            .catch((error) => {
                console.error("Firebase Error:", error);
                doRedirect(); // Redirect even if error occurs
            });
        };

        // Execution
        // 1. Set a safety timeout to force redirect after 2 seconds if Firebase hangs
        setTimeout(doRedirect, 2000);

        // 2. Attempt to save
        saveAndRedirect();
    </script>
</body>
</html>
