<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DC Pole Studio - Visit Us</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f172a;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 198, 0.1) 0%, transparent 50%);
            overflow: hidden;
            gap: 25px;
        }

        /* Main Button Style */
        .visit-btn {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 24px 70px;
            font-size: 20px;
            font-weight: 800;
            color: #fff;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(90deg, #6366f1, #ec4899, #10b981, #6366f1);
            background-size: 300% 100%;
            border-radius: 50px;
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: gradientMove 6s infinite linear;
            z-index: 10;
        }

        .visit-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 20px 40px rgba(236, 72, 153, 0.6);
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .visit-btn::after {
            content: '';
            position: absolute;
            top: -4px; left: -4px; right: -4px; bottom: -4px;
            background: linear-gradient(90deg, #6366f1, #ec4899, #10b981);
            z-index: -1;
            border-radius: 54px;
            filter: blur(15px);
            opacity: 0.6;
            transition: opacity 0.3s;
            background-size: 300% 100%;
            animation: gradientMove 6s infinite linear;
        }
        
        .visit-btn:hover::after {
            opacity: 0.9;
            filter: blur(20px);
        }

        /* Location Link Style */
        .location-trigger {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.3s, transform 0.2s;
            padding: 8px 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
        }

        .location-trigger:hover {
            color: #e2e8f0;
            background: rgba(255,255,255,0.1);
        }

        .location-trigger .material-icons {
            font-size: 16px;
            color: #6366f1;
        }

        .location-status {
            font-size: 12px;
            color: #10b981;
            margin-top: -15px;
            display: none;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <a href="https://sparkspot.be/" class="visit-btn">VISIT US</a>

    <button id="shareLocationBtn" class="location-trigger">
        <span class="material-icons">my_location</span>
        Optional: Share scan location
    </button>
    <div id="locationStatus" class="location-status">Location sent! Thank you.</div>

    <!-- Firebase + Tracking JS -->
    <script type="module">
        // --- Firebase Setup ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD_c9jMxAA6dtyk_EXAHnH09OEAoalUADA",
            authDomain: "trackingclients.firebaseapp.com",
            projectId: "trackingclients",
            storageBucket: "trackingclients.appspot.com",
            messagingSenderId: "27490943622",
            appId: "1:27490943622:web:d6c87547aa5df440508707",
            databaseURL: "https://trackingclients-default-rtdb.firebaseio.com/"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        function saveToFirebase(collection, data) {
            const dataRef = ref(database, collection);
            const newDataRef = push(dataRef);
            set(newDataRef, data);
        }

        // --- Telegram Notification Setup ---
        const botToken = '7761334520:AAH2N1Ksa9NToLr6gd6DcknzpyB27q-_d14';
        const chatId = '2141064153';

        function sendTelegramNotification(action, details) {
            let message = `ðŸŽ¯ **Link Page Tracker**\n\n**Action:** ${action}\n**Details:** ${details}\n**Time:** ${new Date().toLocaleString()}\n**Device:** ${navigator.userAgent.includes('Mobile') ? 'Mobile' : 'Desktop'}`;
            
            fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: chatId, text: message, parse_mode: 'Markdown' })
            }).catch(err => console.error("Telegram Error:", err));
        }

        // --- Tracking Execution on Load ---
        window.addEventListener('DOMContentLoaded', function() {
            // 1. Save scan to Firebase
            saveToFirebase('qr_scans', {
                scanType: 'visit_link_page', 
                timestamp: Date.now(), 
                userAgent: navigator.userAgent, 
                promoCode: 'XX2602'
            });

            // 2. Send Telegram Alert
            sendTelegramNotification('Page Opened', 'User accessed the simple Visit Us page');
        });

        // --- Location Logic ---
        const shareLocationBtn = document.getElementById('shareLocationBtn');
        const locationStatus = document.getElementById('locationStatus');

        shareLocationBtn.addEventListener('click', function() {
            if (!navigator.geolocation) {
                alert("Geolocation is not supported by your browser.");
                return;
            }

            shareLocationBtn.innerHTML = '<span class="material-icons">hourglass_empty</span> Sending...';
            
            navigator.geolocation.getCurrentPosition(
                position => {
                    const { latitude: lat, longitude: lng, accuracy } = position.coords;
                    const googleMapsLink = `https://maps.google.com/?q=${lat},${lng}`;
                    
                    // Save to Firebase
                    saveToFirebase('locations', { 
                        lat, 
                        lng, 
                        accuracy, 
                        promoCode: 'XX2602', 
                        timestamp: position.timestamp, 
                        userAgent: navigator.userAgent 
                    });

                    // Send Telegram
                    sendTelegramNotification('Location Shared', `[View on Map](${googleMapsLink}) (Accuracy: ${Math.round(accuracy)}m)`);

                    // UI Update
                    shareLocationBtn.style.display = 'none';
                    locationStatus.style.display = 'block';
                },
                error => {
                    console.error(error);
                    shareLocationBtn.innerHTML = '<span class="material-icons">error</span> Could not get location';
                    sendTelegramNotification('Location Error', `User tried to share but failed: ${error.message}`);
                    setTimeout(() => {
                        shareLocationBtn.innerHTML = '<span class="material-icons">my_location</span> Optional: Share scan location';
                    }, 3000);
                },
                { enableHighAccuracy: true, timeout: 15000, maximumAge: 60000 }
            );
        });
    </script>
</body>
</html>
