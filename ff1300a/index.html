<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Marketing Activity Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Material Symbols Rounded -->
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,400,0,0"
  />

  <style>
    :root {
      --bg: #f4f4f6;
      --text: #111827;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --accent: #0056b3;

      --online-facebook: #1877f2;
      --online-googlemaps: #34a853;
      --online-tiktok: #000000;
      --online-igreels: #e1306c;
      --online-ytshorts: #ff0000;

      --offline-flyer: #374151;
      --offline-poster: #f97316;
      --offline-b2b: #0ea5e9;
      --offline-handout: #059669;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      background: radial-gradient(circle at top, #ffffff 0, #e5f0ff 45%, #d1d5db 100%);
      color: var(--text);
    }

    body {
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 960px;
      max-height: 100%;
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow:
        0 24px 60px rgba(15, 23, 42, 0.30),
        0 0 0 1px rgba(148, 163, 184, 0.25);
      padding: 16px 18px 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .app-header {
      flex-shrink: 0;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      border-bottom: 1px solid rgba(229,231,235,0.8);
      padding-bottom: 6px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-dot {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #ffffff 0, #7fb3ff 30%, #3b82f6 65%, #1d4ed8 100%);
      box-shadow: 0 2px 6px rgba(37,99,235,0.4);
      flex-shrink: 0;
    }

    .title {
      font-size: 15px;
      font-weight: 650;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .subtitle {
      font-size: 11px;
      color: #6b7280;
    }

    .pill-summary {
      display: inline-flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      border-radius: 999px;
      background: #f3f4ff;
      color: #1d4ed8;
      padding: 4px 10px;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #1d4ed8;
    }

    .tabs {
      flex-shrink: 0;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .tab {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 3px 9px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      font-size: 11px;
      color: #4b5563;
      cursor: pointer;
      transition: background 0.12s ease, border-color 0.12s ease, color 0.12s ease;
      max-width: 100%;
    }

    .tab-icon {
      font-size: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .tab-label {
      white-space: nowrap;
    }

    .tab-count {
      border-radius: 999px;
      padding: 1px 6px;
      background: #e5e7eb;
      font-size: 10px;
      font-variant-numeric: tabular-nums;
      color: #374151;
    }

    .tab.active {
      border-color: var(--accent);
      background: #e0edff;
      color: #1d4ed8;
    }

    .tab.active .tab-count {
      background: #1d4ed8;
      color: #ffffff;
    }

    .table-shell {
      flex: 1 1 auto;
      margin-top: 2px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #f9fafb;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .table-scroll {
      flex: 1 1 auto;
      overflow: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    thead {
      position: sticky;
      top: 0;
      z-index: 1;
      background: linear-gradient(to bottom, #f3f4ff, #e5e7f5);
    }

    th, td {
      padding: 6px 8px;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      border-bottom: 1px solid #e5e7eb;
    }

    th {
      font-weight: 600;
      color: #4b5563;
      font-size: 11px;
    }

    tbody tr:nth-child(even) {
      background: #ffffff;
    }

    tbody tr:nth-child(odd) {
      background: #f9fafb;
    }

    tbody tr:hover {
      background: #e5f0ff;
    }

    .index-cell {
      font-weight: 600;
      color: #111827;
      width: 8%;
    }

    .label-cell {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .label-main {
      font-size: 12px;
      color: #111827;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .label-sub {
      font-size: 10px;
      color: #6b7280;
    }

    .badge {
      border-radius: 999px;
      padding: 3px 7px;
      font-size: 10px;
      font-weight: 600;
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.8);
    }

    .badge-online {
      background: #0f766e;
    }

    .badge-offline {
      background: #7c3aed;
    }

    .date-cell {
      font-variant-numeric: tabular-nums;
      color: #374151;
    }

    .days-cell {
      font-variant-numeric: tabular-nums;
      font-weight: 500;
      color: #111827;
    }

    .days-pill {
      border-radius: 999px;
      padding: 2px 7px;
      background: #eef2ff;
      color: #3730a3;
      font-size: 10px;
    }

    .days-pill-today {
      background: #dcfce7;
      color: #166534;
    }

    .days-pill-older {
      background: #fee2e2;
      color: #b91c1c;
    }

    .total-row {
      flex-shrink: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 4px;
      font-size: 11px;
      color: #6b7280;
      gap: 8px;
    }

    .error-message {
      font-size: 11px;
      color: #b91c1c;
      padding-top: 2px;
    }

    .material-symbols-rounded {
      font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 20;
      font-size: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .icon-circle {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      flex-shrink: 0;
    }

    .icon-facebook   { background: var(--online-facebook); }
    .icon-googlemaps { background: var(--online-googlemaps); }
    .icon-tiktok     { background: var(--online-tiktok); }
    .icon-igreels    { background: var(--online-igreels); }
    .icon-ytshorts   { background: var(--online-ytshorts); }
    .icon-flyer      { background: var(--offline-flyer); }
    .icon-poster     { background: var(--offline-poster); }
    .icon-b2b        { background: var(--offline-b2b); }
    .icon-handout    { background: var(--offline-handout); }

    @media (max-width: 640px) {
      .app {
        padding: 12px 10px;
        border-radius: 14px;
      }
      .title {
        font-size: 13px;
      }
      .subtitle {
        font-size: 10px;
      }
      th:nth-child(3),
      td:nth-child(3) {
        display: none; /* hide Category column on very small screens */
      }
    }
  </style>
</head>
<body>
  <div class="app" aria-label="Marketing Activity Log">
    <header class="app-header">
      <div class="title-block">
        <div class="title-row">
          <div class="logo-dot" aria-hidden="true"></div>
          <div class="title">Marketing Activity Log</div>
        </div>
        <div class="subtitle">Full chronological list of online &amp; offline activities (live from Firebase)</div>
      </div>
      <div class="pill-summary" id="summary-pill" aria-live="polite">
        <span class="pill-dot"></span>
        <span id="summary-text">Loading…</span>
      </div>
    </header>

    <!-- Filter tabs with counts -->
    <nav class="tabs" aria-label="Activity filters" id="tabs">
      <!-- Tabs injected by JS -->
    </nav>

    <section class="table-shell" aria-label="Activity table">
      <div class="table-scroll">
        <table id="activity-table">
          <thead>
            <tr>
              <th scope="col" style="width:8%;">#</th>
              <th scope="col" style="width:46%;">Activity</th>
              <th scope="col" style="width:16%;">Category</th>
              <th scope="col" style="width:14%;">Date</th>
              <th scope="col" style="width:16%;">Days ago</th>
            </tr>
          </thead>
          <tbody id="activity-tbody">
            <!-- rows injected by JS -->
          </tbody>
        </table>
      </div>
    </section>

    <div class="total-row">
      <div id="total-count"></div>
      <div id="error-message" class="error-message" style="display:none;"></div>
    </div>
  </div>

  <script type="module">
    const CAMPAIGN_ID = 'FF1300';
    const TARGET_USER = 'FF1300';

    // Filter keys:
    // all, online, offline, online-facebook, online-googlemaps, online-tiktok,
    // online-igreels, online-ytshorts, offline-flyer, offline-poster, offline-b2b, offline-handout
    let activeFilter = 'all';

    function getDateKeyFromTimestamp(timestamp) {
      if (!timestamp) return null;
      let d;
      if (typeof timestamp === 'number') {
        d = timestamp < 1e12 ? new Date(timestamp * 1000) : new Date(timestamp);
      } else {
        d = new Date(timestamp);
      }
      if (Number.isNaN(d.getTime())) return null;
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function formatDaysAgo(timestamp) {
      if (!timestamp) return 'Unknown';
      let d;
      if (typeof timestamp === 'number') {
        d = timestamp < 1e12 ? new Date(timestamp * 1000) : new Date(timestamp);
      } else {
        d = new Date(timestamp);
      }
      if (Number.isNaN(d.getTime())) return 'Unknown';
      const now = new Date();
      const diffMs = now - d;
      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      if (diffDays <= 0) return 'Today';
      if (diffDays === 1) return '1 day ago';
      return `${diffDays} days ago`;
    }

    function daysPillClass(daysAgoText) {
      if (daysAgoText === 'Today') return 'days-pill days-pill-today';
      const match = daysAgoText.match(/^(\d+)/);
      if (!match) return 'days-pill';
      const days = parseInt(match[1], 10);
      if (days >= 14) return 'days-pill days-pill-older';
      return 'days-pill';
    }

    function tagLabel(type, tag) {
      if (type === 'online') {
        switch (tag) {
          case 'facebook':  return 'Facebook Groups';
          case 'googlemaps':return 'Google Maps';
          case 'tiktok':    return 'TikTok';
          case 'igreels':   return 'Instagram Reels';
          case 'ytshorts':  return 'YouTube Shorts';
          default:          return 'Online';
        }
      } else {
        switch (tag) {
          case 'flyer':     return 'Mailboxes';
          case 'poster':    return 'Poster';
          case 'b2b':       return 'B2B';
          case 'handout':   return 'Handouts';
          default:          return 'Offline';
        }
      }
    }

    function iconHtml(type, tag) {
      if (type === 'online') {
        switch (tag) {
          case 'facebook':
            return `<span class="icon-circle icon-facebook"><span class="material-symbols-rounded">group</span></span>`;
          case 'googlemaps':
            return `<span class="icon-circle icon-googlemaps"><span class="material-symbols-rounded">location_on</span></span>`;
          case 'tiktok':
            return `<span class="icon-circle icon-tiktok"><span class="material-symbols-rounded">music_note</span></span>`;
          case 'igreels':
            return `<span class="icon-circle icon-igreels"><span class="material-symbols-rounded">play_circle</span></span>`;
          case 'ytshorts':
            return `<span class="icon-circle icon-ytshorts"><span class="material-symbols-rounded">smart_display</span></span>`;
          default:
            return `<span class="icon-circle icon-facebook"><span class="material-symbols-rounded">public</span></span>`;
        }
      } else {
        switch (tag) {
          case 'flyer':
            return `<span class="icon-circle icon-flyer"><span class="material-symbols-rounded">mail</span></span>`;
          case 'poster':
            return `<span class="icon-circle icon-poster"><span class="material-symbols-rounded">image</span></span>`;
          case 'b2b':
            return `<span class="icon-circle icon-b2b"><span class="material-symbols-rounded">storefront</span></span>`;
          case 'handout':
            return `<span class="icon-circle icon-handout"><span class="material-symbols-rounded">diversity_1</span></span>`;
          default:
            return `<span class="icon-circle icon-flyer"><span class="material-symbols-rounded">local_offer</span></span>`;
        }
      }
    }

    // aggregate storage
    const activityItems = []; // { type, tag, label, timestamp, lat, lng, url, source }

    const tabDefs = [
      { key: 'all',              label: 'All',          icon: 'all_inclusive' },
      { key: 'online',           label: 'Online',       icon: 'wifi' },
      { key: 'offline',          label: 'Offline',      icon: 'store' },
      { key: 'online-facebook',  label: 'Facebook',     icon: 'group' },
      { key: 'online-googlemaps',label: 'Google Maps',  icon: 'location_on' },
      { key: 'online-tiktok',    label: 'TikTok',       icon: 'music_note' },
      { key: 'online-igreels',   label: 'IG Reels',     icon: 'play_circle' },
      { key: 'online-ytshorts',  label: 'YT Shorts',    icon: 'smart_display' },
      { key: 'offline-flyer',    label: 'Mailboxes',    icon: 'mail' },
      { key: 'offline-poster',   label: 'Posters',      icon: 'image' },
      { key: 'offline-b2b',      label: 'B2B',          icon: 'storefront' },
      { key: 'offline-handout',  label: 'Handouts',     icon: 'diversity_1' },
    ];

    function computeCounts() {
      const counts = {};
      for (const def of tabDefs) counts[def.key] = 0;

      for (const item of activityItems) {
        // all
        counts['all'] = (counts['all'] || 0) + 1;

        // online/offline
        if (item.type === 'online') {
          counts['online'] = (counts['online'] || 0) + 1;
          counts[`online-${item.tag}`] = (counts[`online-${item.tag}`] || 0) + 1;
        } else if (item.type === 'offline') {
          counts['offline'] = (counts['offline'] || 0) + 1;
          counts[`offline-${item.tag}`] = (counts[`offline-${item.tag}`] || 0) + 1;
        }
      }
      return counts;
    }

    function renderTabs() {
      const tabsContainer = document.getElementById('tabs');
      const counts = computeCounts();
      tabsContainer.innerHTML = '';

      tabDefs.forEach(def => {
        const count = counts[def.key] || 0;
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'tab' + (def.key === activeFilter ? ' active' : '');
        btn.dataset.filterKey = def.key;
        btn.innerHTML = `
          <span class="material-symbols-rounded tab-icon">${def.icon}</span>
          <span class="tab-label">${def.label}</span>
          <span class="tab-count">${count}</span>
        `;
        btn.addEventListener('click', () => {
          activeFilter = def.key;
          renderTabs();
          renderTable();
        });
        tabsContainer.appendChild(btn);
      });
    }

    function matchesFilter(item) {
      if (activeFilter === 'all') return true;
      if (activeFilter === 'online') return item.type === 'online';
      if (activeFilter === 'offline') return item.type === 'offline';

      const [scope, tag] = activeFilter.split('-');
      if (scope === 'online') {
        return item.type === 'online' && item.tag === tag;
      }
      if (scope === 'offline') {
        return item.type === 'offline' && item.tag === tag;
      }
      return true;
    }

    function renderTable() {
      const tbody = document.getElementById('activity-tbody');
      const totalCountEl = document.getElementById('total-count');
      const summaryTextEl = document.getElementById('summary-text');

      const sorted = [...activityItems].sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
      const filtered = sorted.filter(matchesFilter);

      tbody.innerHTML = '';
      let onlineCount = 0;
      let offlineCount = 0;

      filtered.forEach((item, index) => {
        if (item.type === 'online') onlineCount += 1;
        if (item.type === 'offline') offlineCount += 1;

        const tr = document.createElement('tr');

        const indexTd = document.createElement('td');
        indexTd.textContent = String(index + 1);
        indexTd.className = 'index-cell';

        const labelTd = document.createElement('td');
        labelTd.className = 'label-cell';

        const labelMain = document.createElement('div');
        labelMain.className = 'label-main';
        labelMain.innerHTML = `${iconHtml(item.type, item.tag)}<span>${item.label || tagLabel(item.type, item.tag)}</span>`;

        const labelSub = document.createElement('div');
        labelSub.className = 'label-sub';
        labelSub.textContent = `${tagLabel(item.type, item.tag)} · ${item.source}`;

        labelTd.appendChild(labelMain);
        labelTd.appendChild(labelSub);

        const categoryTd = document.createElement('td');
        const badge = document.createElement('span');
        badge.className = 'badge ' + (item.type === 'online' ? 'badge-online' : 'badge-offline');
        badge.innerHTML = `<span class="badge-dot"></span>${item.type === 'online' ? 'Online' : 'Offline'}`;
        categoryTd.appendChild(badge);

        const dateTd = document.createElement('td');
        dateTd.className = 'date-cell';
        dateTd.textContent = getDateKeyFromTimestamp(item.timestamp) || 'Unknown';

        const daysTd = document.createElement('td');
        daysTd.className = 'days-cell';
        const daysAgoText = formatDaysAgo(item.timestamp);
        const pill = document.createElement('span');
        pill.className = daysPillClass(daysAgoText);
        pill.textContent = daysAgoText;
        daysTd.appendChild(pill);

        tr.appendChild(indexTd);
        tr.appendChild(labelTd);
        tr.appendChild(categoryTd);
        tr.appendChild(dateTd);
        tr.appendChild(daysTd);

        if (item.url) {
          tr.style.cursor = 'pointer';
          tr.addEventListener('click', () => {
            window.open(item.url, '_blank', 'noopener,noreferrer');
          });
        }

        tbody.appendChild(tr);
      });

      const total = filtered.length;
      const totalRaw = activityItems.length;
      totalCountEl.textContent = totalRaw === 0
        ? 'No activity yet.'
        : `${total} shown · ${totalRaw} total · ${onlineCount} online · ${offlineCount} offline`;

      if (totalRaw === 0) {
        summaryTextEl.textContent = 'No activity recorded yet';
      } else {
        const latest = sorted[0];
        const latestDaysText = formatDaysAgo(latest.timestamp);
        const latestDate = getDateKeyFromTimestamp(latest.timestamp) || 'Unknown date';
        summaryTextEl.textContent = `Latest activity: ${latestDaysText} (${latestDate})`;
      }
    }

    const firebaseConfig = {
      apiKey: "AIzaSyBuBB-Cha7eLG1O7SxOTfFt8e6hVAWjkxI",
      authDomain: "tokentransfer-4a9b3.firebaseapp.com",
      databaseURL: "https://tokentransfer-4a9b3-default-rtdb.firebaseio.com",
      projectId: "tokentransfer-4a9b3",
      storageBucket: "tokentransfer-4a9b3.firebasestorage.app",
      messagingSenderId: "205455490321",
      appId: "1:205455490321:web:9919f5dde059316c9320b0"
    };

    const errorEl = document.getElementById('error-message');

    (async () => {
      try {
        const { initializeApp } = await import("https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js");
        const { getDatabase, ref, query, orderByChild, onValue } =
          await import("https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js");

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Original mailboxes
        const userPostsRef = query(ref(db, `userPosts/${TARGET_USER}`), orderByChild('timestamp'));
        onValue(userPostsRef, (snapshot) => {
          for (let i = activityItems.length - 1; i >= 0; i--) {
            if (activityItems[i].source === 'Original route (mailboxes)') {
              activityItems.splice(i, 1);
            }
          }

          if (snapshot.exists()) {
            snapshot.forEach(child => {
              const v = child.val();
              if (!v) return;
              if (typeof v.lat !== 'number' || typeof v.lng !== 'number') return;
              activityItems.push({
                type: 'offline',
                tag: 'flyer',
                label: 'Mailbox delivery',
                timestamp: v.timestamp ?? null,
                lat: v.lat,
                lng: v.lng,
                url: '',
                source: 'Original route (mailboxes)'
              });
            });
          }

          renderTabs();
          renderTable();
        });

        const campaignOnlineRef   = ref(db, `campaigns/${CAMPAIGN_ID}/online`);
        const campaignOfflineRef  = ref(db, `campaigns/${CAMPAIGN_ID}/offline`);
        const campaignHandoutsRef = ref(db, `campaigns/${CAMPAIGN_ID}/handouts`);

        // Campaign online
        onValue(campaignOnlineRef, (snapshot) => {
          for (let i = activityItems.length - 1; i >= 0; i--) {
            if (activityItems[i].source === 'Campaign online') {
              activityItems.splice(i, 1);
            }
          }

          if (snapshot.exists()) {
            snapshot.forEach(child => {
              const v = child.val();
              if (!v) return;
              if (typeof v.lat !== 'number' || typeof v.lng !== 'number') return;
              if (!v.tag || !v.url) return;

              activityItems.push({
                type: 'online',
                tag: v.tag,
                label: tagLabel('online', v.tag),
                timestamp: v.timestamp || Date.now(),
                lat: v.lat,
                lng: v.lng,
                url: v.url,
                source: 'Campaign online'
              });
            });
          }

          renderTabs();
          renderTable();
        });

        // Campaign offline (flyer/poster/B2B)
        onValue(campaignOfflineRef, (snapshot) => {
          for (let i = activityItems.length - 1; i >= 0; i--) {
            if (activityItems[i].source === 'Campaign offline') {
              activityItems.splice(i, 1);
            }
          }

          if (snapshot.exists()) {
            snapshot.forEach(child => {
              const v = child.val();
              if (!v) return;
              if (typeof v.lat !== 'number' || typeof v.lng !== 'number') return;
              if (!['flyer','poster','b2b'].includes(v.kind)) return;

              activityItems.push({
                type: 'offline',
                tag: v.kind,
                label: tagLabel('offline', v.kind),
                timestamp: v.timestamp || Date.now(),
                lat: v.lat,
                lng: v.lng,
                url: v.url || '',
                source: 'Campaign offline'
              });
            });
          }

          renderTabs();
          renderTable();
        });

        // Campaign handouts
        onValue(campaignHandoutsRef, (snapshot) => {
          for (let i = activityItems.length - 1; i >= 0; i--) {
            if (activityItems[i].source === 'Campaign handouts') {
              activityItems.splice(i, 1);
            }
          }

          if (snapshot.exists()) {
            let batchIndex = 0;
            snapshot.forEach(child => {
              const v = child.val();
              if (!v) return;
              if (typeof v.count !== 'number' || v.count <= 0) return;
              if (typeof v.lat !== 'number' || typeof v.lng !== 'number') return;
              const ts = v.timestamp || Date.now();
              batchIndex += 1;

              activityItems.push({
                type: 'offline',
                tag: 'handout',
                label: `Handout batch #${batchIndex} (${v.count})`,
                timestamp: ts,
                lat: v.lat,
                lng: v.lng,
                url: v.url || '',
                source: 'Campaign handouts'
              });
            });
          }

          renderTabs();
          renderTable();
        });

        // initial empty render
        renderTabs();
        renderTable();

      } catch (e) {
        console.error('Failed to load Firebase data for activity log', e);
        errorEl.style.display = 'block';
        errorEl.textContent = 'Failed to load data from Firebase. Check console for details.';
        document.getElementById('summary-text').textContent = 'Error loading data';
      }
    })();
  </script>
</body>
</html>
