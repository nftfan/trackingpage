<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>LeuvenFlyers ‚Äî Campaign Dashboard</title>
    <meta name="color-scheme" content="light dark" />
    <style>
      :root {
        --bg-primary: #0a0e17;
        --bg-secondary: #0d1322;
        --surface-1: #0f1628;
        --surface-2: #131b2e;
        --surface-3: #172237;

        --border-light: rgba(255, 255, 255, 0.08);
        --border-medium: rgba(255, 255, 255, 0.12);

        --text-primary: #f0f4f9;
        --text-secondary: #b0b8c7;
        --text-tertiary: #ffffff;

        --color-primary: #5b9cff;
        --color-primary-dark: #4a89e8;
        --color-accent: #6ea8ff;

        --color-success: #10b981;
        --color-warning: #f59e0b;
        --color-danger: #ef4444;
        --color-info: #3b82f6;

        --radius-md: 10px;
        --radius-lg: 14px;
        --radius-xl: 18px;

        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
        --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.25);
        --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.3);

        --transition-fast: 150ms ease;
        --transition-normal: 250ms ease;
      }

      @media (prefers-color-scheme: light) {
        :root {
          --bg-primary: #f8fafc;
          --bg-secondary: #f1f5f9;
          --surface-1: #ffffff;
          --surface-2: #f8fafc;
          --surface-3: #f1f5f9;

          --border-light: rgba(15, 23, 42, 0.06);
          --border-medium: rgba(15, 23, 42, 0.1);

          --text-primary: #0f172a;
          --text-secondary: #475569;
          --text-tertiary: #64748b;

          --color-primary: #4f46e5;
          --color-primary-dark: #4338ca;
          --color-accent: #6366f1;

          --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
          --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
          --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
        }
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.5;
        letter-spacing: -0.005em;
        font-size: 14px;
      }

      .container {
        max-width: 1280px;
        margin: 0 auto;
        padding: 12px;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        margin-bottom: 16px;
        gap: 12px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 0;
      }

      .logo {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
        border-radius: var(--radius-lg);
        color: white;
        font-weight: 800;
        font-size: 16px;
        box-shadow: var(--shadow-md);
        flex-shrink: 0;
      }

      .logo-text { display: flex; flex-direction: column; min-width: 0; }
      .logo-title { font-size: 14px; font-weight: 700; line-height: 1.2; }
      .logo-subtitle { font-size: 10px; color: var(--text-tertiary); font-weight: 500; }

      .page-title { margin-bottom: 16px; }
      .page-title h1 {
        margin: 0 0 4px 0;
        font-size: 20px;
        font-weight: 700;
        line-height: 1.2;
      }
      .page-title p { margin: 0; font-size: 11px; color: var(--text-secondary); }

      .badges-row {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 6px 10px;
        background: var(--surface-2);
        border: 1px solid var(--border-medium);
        border-radius: 999px;
        font-size: 10px;
        color: var(--text-secondary);
        font-weight: 600;
      }
      .badge-value { color: var(--text-primary); font-weight: 700; }

      .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
        margin-bottom: 16px;
      }

      .kpi-card {
        background: #dd4033;
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
        padding: 12px;
        box-shadow: var(--shadow-sm);
        transition: all var(--transition-normal);
        text-decoration: none;
        color: inherit;
        display: flex;
        flex-direction: column;
      }

      .kpi-card-action { cursor: pointer; }

      .kpi-card-action--track {
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
        color: #ffffff;
      }
      .kpi-card-action--plan {
        background: linear-gradient(135deg, var(--color-success) 0%, #059669 100%);
        color: #ffffff;
      }
      .kpi-card-action--track .kpi-label,
      .kpi-card-action--plan .kpi-label {
        color: rgba(255,255,255,0.85);
      }
      .kpi-card-action--track .kpi-description,
      .kpi-card-action--plan .kpi-description {
        color: rgba(255,255,255,0.75);
      }

      .kpi-card:active {
        border-color: var(--border-medium);
        box-shadow: var(--shadow-md);
      }

      .kpi-header {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 8px;
      }
      .kpi-icon { font-size: 16px; flex-shrink: 0; }
      .kpi-label {
        font-size: 9px;
        color: var(--text-tertiary);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        line-height: 1.1;
      }
      .kpi-value {
        font-size: 20px;
        font-weight: 800;
        margin: 4px 0;
        letter-spacing: -0.02em;
        line-height: 1.2;
      }
      .kpi-description { font-size: 10px; color: var(--text-tertiary); line-height: 1.3; }

      .progress-bar {
        margin-top: 8px;
        height: 5px;
        background: var(--surface-2);
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid var(--border-light);
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-accent) 100%);
        width: var(--progress, 0%);
        transition: width 500ms ease;
        border-radius: 999px;
      }

      @media (min-width: 769px) {
        .container { padding: 16px; }
        .header { margin-bottom: 24px; gap: 16px; }
        .logo { width: 44px; height: 44px; font-size: 18px; }
        .logo-title { font-size: 16px; }
        .logo-subtitle { font-size: 11px; }
        .page-title h1 { font-size: 24px; margin-bottom: 6px; }
        .page-title p { font-size: 12px; }
        .badges-row { gap: 10px; margin-top: 12px; }
        .badge { font-size: 11px; padding: 7px 12px; }
        .kpi-grid { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 14px; margin-bottom: 24px; }
        .kpi-card { padding: 18px; }
        .kpi-icon { font-size: 18px; }
        .kpi-label { font-size: 11px; }
        .kpi-value { font-size: 26px; margin: 6px 0; }
        .kpi-description { font-size: 11px; }
        .kpi-card:hover {
          border-color: var(--border-medium);
          box-shadow: var(--shadow-md);
          transform: translateY(-1px);
        }
      }

      .section { margin-bottom: 16px; }
      .section-title {
        font-size: 12px;
        font-weight: 700;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.03em;
      }

      .table-container {
        background: var(--surface-1);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        overflow: hidden;
      }
      table { width: 100%; border-collapse: collapse; }
      thead th {
        padding: 10px;
        text-align: left;
        background: var(--surface-2);
        border-bottom: 1px solid var(--border-medium);
        font-size: 10px;
        font-weight: 700;
        color: var(--text-tertiary);
        text-transform: uppercase;
        letter-spacing: 0.03em;
      }
      tbody td {
        padding: 10px;
        border-bottom: 1px solid var(--border-light);
        font-size: 11px;
        vertical-align: top;
      }
      tbody tr:last-child td { border-bottom: none; }
      tbody tr { transition: background-color var(--transition-fast); }
      tbody tr:active { background: var(--surface-2); }

      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 5px 9px;
        border-radius: 5px;
        font-size: 10px;
        font-weight: 700;
        border: 1px solid transparent;
        white-space: nowrap;
      }
      .status-dot {
        width: 5px;
        height: 5px;
        border-radius: 999px;
        flex-shrink: 0;
      }
      .status-completed {
        background: rgba(16,185,129,0.1);
        color: var(--color-success);
        border-color: rgba(16,185,129,0.2);
      }
      .status-completed .status-dot { background: var(--color-success); }
      .status-in-progress {
        background: rgba(95,156,255,0.1);
        color: var(--color-primary);
        border-color: rgba(95,156,255,0.2);
      }
      .status-in-progress .status-dot {
        background: var(--color-primary);
        animation: pulse 2s infinite;
      }
      .status-pending {
        background: rgba(245,158,11,0.1);
        color: var(--color-warning);
        border-color: rgba(245,158,11,0.2);
      }
      .status-pending .status-dot { background: var(--color-warning); }

      @keyframes pulse {
        0%,100% { opacity:1; }
        50% { opacity:.5; }
      }

      .note-text {
        color: var(--text-tertiary);
        text-align: right;
        font-size: 10px;
        line-height: 1.4;
      }

      .right { text-align: right; }

      @media (max-width: 768px) {
        thead { display: none; }
        table, tbody, tr, td { display: block; width: 100%; }
        tbody tr {
          background: var(--surface-2);
          border: 1px solid var(--border-medium);
          border-radius: var(--radius-md);
          padding: 10px;
          margin-bottom: 8px;
          display: flex;
          flex-direction: column;
          gap: 8px;
        }
        tbody td { border: 0; padding: 0; }
        tbody td[data-label]::before {
          content: attr(data-label);
          display: block;
          font-size: 9px;
          font-weight: 700;
          color: var(--text-tertiary);
          text-transform: uppercase;
          letter-spacing: 0.03em;
          margin-bottom: 2px;
        }
        .note-text { text-align: left; }
      }

      :focus-visible { outline: 2px solid var(--color-primary); outline-offset: 2px; }

      @media (prefers-reduced-motion: reduce) {
        * { animation-duration: .01ms !important; animation-iteration-count:1 !important; transition-duration:.01ms !important; }
      }

      @media (hover: none) and (pointer: coarse) {
        .kpi-card:active { border-color: var(--border-medium); opacity: 0.9; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="header-left">
          <div class="logo">LF</div>
          <div class="logo-text">
            <div class="logo-title">LeuvenFlyers</div>
            <div class="logo-subtitle">Dashboard</div>
          </div>
        </div>
      </div>

      <div class="page-title">
        <h1>Campaign Dashboard</h1>
        <p id="subtitle">Campaign XX1010 ‚Ä¢ Real-time performance tracking</p>
        <div class="badges-row">
          <span class="badge">
            <span>ID:</span>
            <span class="badge-value" id="pillCampaign">XX1010</span>
          </span>
          <span class="badge">
            <span>Sector:</span>
            <span class="badge-value" id="sectorValue">Food</span>
          </span>
          <span class="badge">
            <span>Printed:</span>
            <span class="badge-value" id="totalFlyersBadge">24,500</span>
          </span>
          <span class="badge" id="statusPill" style="display:none;">
            <span>Status:</span>
            <span class="badge-value" id="campaignStatus">‚Äî</span>
          </span>
        </div>
      </div>

      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-header">
            <div class="kpi-icon">üì¶</div>
            <div class="kpi-label">Delivered</div>
          </div>
          <div class="kpi-value" id="flyersDistributed">0</div>
          <div class="progress-bar">
            <div class="progress-fill" id="distributionBar" style="--progress:0%"></div>
          </div>
          <div class="kpi-description"><span id="distributionPct">0%</span> of printed</div>
        </div>

        <a class="kpi-card kpi-card-action kpi-card-action--track" id="cardTrackLink" href="#" target="_blank" rel="noopener" aria-label="Track flyers">
          <div class="kpi-header">
            <div class="kpi-icon">üõ∞Ô∏è</div>
            <div class="kpi-label">Track Flyers</div>
          </div>
          <div class="kpi-value">Open</div>
          <div class="kpi-description">View live flyer tracking</div>
        </a>

        <a class="kpi-card kpi-card-action kpi-card-action--plan" id="cardPlanLink" href="#" target="_blank" rel="noopener" aria-label="View distribution plan">
          <div class="kpi-header">
            <div class="kpi-icon">üó∫Ô∏è</div>
            <div class="kpi-label">Distribution Plan</div>
          </div>
          <div class="kpi-value">View</div>
          <div class="kpi-description">See area coverage plan</div>
        </a>
      </div>

      <div class="section">
        <h2 class="section-title">Milestones</h2>
        <div class="table-container">
          <table role="table" aria-label="Milestone status table">
            <thead>
              <tr>
                <th scope="col">Milestone</th>
                <th scope="col">Status</th>
                <th scope="col" class="right">Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td data-label="Milestone">Campaign planning</td>
                <td data-label="Status">
                  <span id="status-initial_planning" class="status-badge status-completed">
                    <span class="status-dot"></span> Done
                  </span>
                </td>
                <td data-label="Notes" class="right note-text">
                  <span id="note-initial_planning">Finalized</span>
                </td>
              </tr>
              <tr>
                <td data-label="Milestone">Find distributor</td>
                <td data-label="Status">
                  <span id="status-distributor" class="status-badge status-completed">
                    <span class="status-dot"></span> Done
                  </span>
                </td>
                <td data-label="Notes" class="right note-text">
                  <span id="note-distributor">Confirmed</span>
                </td>
              </tr>
              <tr>
                <td data-label="Milestone">Printing</td>
                <td data-label="Status">
                  <span id="status-printing" class="status-badge status-completed">
                    <span class="status-dot"></span> Done
                  </span>
                </td>
                <td data-label="Notes" class="right note-text">
                  <span id="note-printing">24.5k</span>
                </td>
              </tr>
              <tr>
                <td data-label="Milestone">Pick up</td>
                <td data-label="Status">
                  <span id="status-pickup" class="status-badge status-in-progress">
                    <span class="status-dot"></span> Active
                  </span>
                </td>
                <td data-label="Notes" class="right note-text">
                  <span id="note-pickup">Scheduled</span>
                </td>
              </tr>
              <tr>
                <td data-label="Milestone">Distribution</td>
                <td data-label="Status">
                  <span id="status-distribution" class="status-badge status-pending">
                    <span class="status-dot"></span> Pending
                  </span>
                </td>
                <td data-label="Notes" class="right note-text">
                  <span id="note-distribution">0%</span>
                </td>
              </tr>
              <tr>
                <td data-label="Milestone">Payment</td>
                <td data-label="Status">
                  <span id="status-payment" class="status-badge status-pending">
                    <span class="status-dot"></span> Pending
                  </span>
                </td>
                <td data-label="Notes" class="right note-text">
                  <span id="note-payment">On completion</span>
                </td>
              </tr>
              <tr>
                <td data-label="Milestone">Feedback</td>
                <td data-label="Status">
                  <span id="status-feedback" class="status-badge status-pending">
                    <span class="status-dot"></span> Pending
                  </span>
                </td>
                <td data-label="Notes" class="right note-text">
                  <span id="note-feedback">Awaiting scans</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyD_c9jMxAA6dtyk_EXAHnH09OEAoalUADA",
        authDomain: "trackingclients.firebaseapp.com",
        projectId: "trackingclients",
        storageBucket: "trackingclients.appspot.com",
        messagingSenderId: "27490943622",
        appId: "1:27490943622:web:d6c87547aa5df440508707",
        databaseURL: "https://trackingclients-default-rtdb.firebaseio.com/"
      };

      const CAMPAIGN_ID = "XX1010";

      // Elements
      const printedBadgeEl = document.getElementById("totalFlyersBadge");
      const distEl = document.getElementById("flyersDistributed");
      const barEl = document.getElementById("distributionBar");
      const pctEl = document.getElementById("distributionPct");
      const sectorEl = document.getElementById("sectorValue");
      const campaignStatusEl = document.getElementById("campaignStatus");
      const statusPill = document.getElementById("statusPill");
      const subtitleEl = document.getElementById("subtitle");
      const pillCampaign = document.getElementById("pillCampaign");
      const cardTrackLink = document.getElementById("cardTrackLink");
      const cardPlanLink = document.getElementById("cardPlanLink");

      const STEP_KEYS = [
        "initial_planning",
        "distributor",
        "printing",
        "pickup",
        "distribution",
        "payment",
        "feedback"
      ];

      let totalFlyers = 24500;
      let distributedLatest = 0;

      const app = initializeApp(firebaseConfig, "campaignAppDashboard");
      const db = getDatabase(app);

      const toInt = (v) => {
        if (v === null || v === undefined) return 0;
        const n = Number(v);
        return Number.isFinite(n) ? n : parseInt(String(v).replace(/[^\d.-]/g, ""), 10) || 0;
        };

      function setProgress() {
        const pct = totalFlyers > 0 ? (distributedLatest / totalFlyers) * 100 : 0;
        const pctClamped = Math.max(0, Math.min(100, pct));

        if (barEl) barEl.style.setProperty("--progress", pctClamped.toFixed(1) + "%");
        if (pctEl) pctEl.textContent = Math.round(pctClamped) + "%";

        const badge = document.getElementById("status-distribution");
        const note = document.getElementById("note-distribution");
        if (badge) {
          badge.classList.remove("status-pending", "status-in-progress", "status-completed");
          if (pctClamped >= 100) {
            badge.classList.add("status-completed");
            badge.setAttribute("aria-label", "Completed");
            badge.innerHTML = '<span class="status-dot"></span> Done';
          } else if (pctClamped <= 0) {
            badge.classList.add("status-pending");
            badge.setAttribute("aria-label", "Pending");
            badge.innerHTML = '<span class="status-dot"></span> Pending';
          } else {
            badge.classList.add("status-in-progress");
            badge.setAttribute("aria-label", "In Progress");
            badge.innerHTML = '<span class="status-dot"></span> Active';
          }
        }
        if (note) note.textContent = `${Math.round(pctClamped)}%`;
      }

      function statusToClass(status) {
        if (status === "completed") return "status-completed";
        if (status === "in_progress") return "status-in-progress";
        return "status-pending";
      }
      function statusToLabel(status) {
        if (status === "completed") return "Done";
        if (status === "in_progress") return "Active";
        return "Pending";
      }
      function setBadge(id, statusValue) {
        const el = document.getElementById(id);
        if (!el) return;
        const cls = statusToClass(statusValue);
        el.className = `status-badge ${cls}`;
        el.setAttribute("aria-label", statusToLabel(statusValue));
        el.innerHTML = `<span class="status-dot"></span> ${statusToLabel(statusValue)}`;
      }
      function setNote(id, text) {
        if (id === "note-distribution") return; // handled in setProgress
        const el = document.getElementById(id);
        if (el) el.textContent = text || "";
      }
      function setTotalFlyersUI(val) {
        totalFlyers = Math.max(0, toInt(val));
        if (printedBadgeEl) printedBadgeEl.textContent = totalFlyers.toLocaleString();
        setProgress();
      }

      function setCtaLinksFromId(id) {
        const digits = (id.match(/\d+/) || [""])[0];
        const suffix = digits || id.toLowerCase();
        const flyersUrl = `https://leuvenflyers.com/ff${suffix}`;
        const areasUrl = `https://leuvenflyers.com/xx${suffix}`;
        if (cardTrackLink) cardTrackLink.href = flyersUrl;
        if (cardPlanLink) cardPlanLink.href = areasUrl;
      }
      setCtaLinksFromId(CAMPAIGN_ID);

      onValue(ref(db, `campaigns/${CAMPAIGN_ID}/meta`), (snap) => {
        const meta = snap.val() || {};
        if (meta.totalFlyers != null) setTotalFlyersUI(meta.totalFlyers);
        if (meta.sector) sectorEl.textContent = meta.sector;
        if (meta.status) {
          statusPill.style.display = "inline-flex";
          campaignStatusEl.textContent = meta.status.replace(/_/g, " ");
          subtitleEl.textContent = `Campaign ${CAMPAIGN_ID} ‚Ä¢ ${meta.status.replace(/_/g, " ").toUpperCase()}`;
        } else {
          statusPill.style.display = "none";
          subtitleEl.textContent = `Campaign ${CAMPAIGN_ID} ‚Ä¢ Real-time performance tracking`;
        }
        pillCampaign.textContent = CAMPAIGN_ID;
        setCtaLinksFromId(CAMPAIGN_ID);
      }, (err) => console.error("Failed to read meta", err));

      onValue(ref(db, `campaigns/${CAMPAIGN_ID}/steps`), (snap) => {
        const steps = snap.val() || {};
        STEP_KEYS.forEach((k) => {
          const s = steps[k] || {};
          setBadge(`status-${k}`, s.status || "pending");
          setNote(`note-${k}`, s.note || "");
        });
      }, (err) => console.error("Failed to read steps", err));

      onValue(ref(db, `campaigns/${CAMPAIGN_ID}/zone_statuses`), (snap) => {
        let distributed = 0;
        if (snap.exists()) {
          snap.forEach((child) => {
            const z = child.val() || {};
            if (z.status === "completed") {
              distributed += toInt(z.flyers);
            }
          });
        }
        distributedLatest = distributed;
        if (distEl) distEl.textContent = distributedLatest.toLocaleString();
        setProgress();
      }, (err) => {
        console.error("Failed to read zone_statuses", err);
        distributedLatest = 0;
        if (distEl) distEl.textContent = "0";
        setProgress();
      });

      // Initialize UI with defaults
      setTotalFlyersUI(totalFlyers);
    </script>
  </body>
</html>
