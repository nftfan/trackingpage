<!DOCTYPE html>
<html lang="en">
<head>
  <title>Pak Portal &mdash; 1 PPC = 1000 PKR</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      background: #f7f7fa;
      color: #333;
      font-family: 'Roboto', 'Arial', sans-serif;
      margin: 0;
      min-height: 100vh;
    }
    .top-bar {
      width: 100%;
      background: #fff;
      border-bottom: 1.5px solid #ececec;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 1px 6px 0 #ececec;
      min-height: 62px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .title {
      font-size: 28px;
      font-weight: 800;
      color: #7a3cff;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 32px;
      letter-spacing: 1.2px;
    }
    .exchange-rate {
      font-size: 14px;
      color: #ffd600;
      background: #333;
      border-radius: 6px;
      padding: 2px 10px;
      margin-left: 13px;
      font-weight: 700;
      letter-spacing: 1.1px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .status-bar {
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 18px;
      padding: 0 32px;
    }
    .status-bar .material-icons {
      font-size: 22px;
      vertical-align: middle;
      color: #9699b3;
      margin-right: 2px;
    }
    .key-short {
      color: #7a3cff;
      font-weight: 600;
      font-size: 18px;
      background: #f5f3ff;
      border-radius: 8px;
      padding: 6px 16px;
      margin-right: 6px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .delete-btn {
      background: #eee;
      color: #7a3cff;
      border: none;
      border-radius: 6px;
      height: 36px;
      min-width: 36px;
      padding: 0;
      font-size: 20px;
      margin-left: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .delete-btn:hover {
      background: #fdd;
      color: #e53935;
    }
    .credit-box {
      color: #fff;
      background: #7a3cff;
      border-radius: 8px;
      font-weight: 700;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 20px;
      letter-spacing: 1px;
      box-shadow: 0 1px 8px #ece6fa;
    }
    .balance-tabs {
      display: flex;
      gap: 36px;
      margin: 46px 0 32px 40px;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    .balance-tab {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 3px 16px #ece6fa;
      padding: 30px 38px 28px 38px;
      min-width: 240px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 11px;
      border-left: 7px solid #7a3cff;
      font-size: 22px;
      font-weight: 700;
      position: relative;
    }
    .balance-tab .material-icons {
      font-size: 32px;
      color: #7a3cff;
      margin-right: 14px;
      vertical-align: middle;
    }
    .balance-label {
      color: #9699b3;
      font-size: 18px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 3px;
    }
    .balance-value {
      font-size: 34px;
      color: #222;
      font-weight: 900;
      letter-spacing: 1.5px;
      margin-top: 2px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    /* Returned tab highlight */
    .balance-tab.returned {
      border-left: 7px solid #42b883;
      background: #edfff2;
    }
    .balance-label.returned {
      color: #42b883;
    }
    .balance-tab .material-icons.returned {
      color: #42b883;
    }
    .sections-wrap {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 18px 60px 18px;
    }
    .card-section {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 1px 10px 0 #ececec;
      margin-bottom: 28px;
      padding: 34px 34px 26px 34px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .card-section.processing {
      background: #f5f3ff;
      border-left: 7px solid #7a3cff;
      margin-bottom: 32px;
    }
    .card-section.financial {
      background: #fffbea;
      border-left: 7px solid #ffd600;
      margin-bottom: 32px;
    }
    .card-section.support {
      background: #f3f9ff;
      border-left: 7px solid #2196f3;
      margin-bottom: 32px;
    }
    .section-title {
      font-size: 24px;
      font-weight: 800;
      color: #7a3cff;
      margin-bottom: 6px;
      letter-spacing: 1.3px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .section-title.financial {
      color: #ffd600;
    }
    .section-title.support {
      color: #2196f3;
    }
    .section-title.returned {
      color: #42b883;
    }
    .row {
      display: flex;
      align-items: flex-start;
      gap: 22px;
      font-size: 19px;
      font-weight: 500;
      color: #444;
      margin: 0 0 10px 0;
      padding: 0 0 0 2px;
    }
    .row .label {
      min-width: 170px;
      font-weight: 700;
      color: #7a3cff;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .row .label.financial {
      color: #ffd600;
    }
    .row .label.support {
      color: #2196f3;
    }
    .row .label.returned {
      color: #42b883;
    }
    .row .value {
      color: #333;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .row .date {
      color: #888;
      font-size: 15px;
      margin-left: 18px;
      font-weight: 500;
      letter-spacing: .5px;
      display: flex;
      align-items: center;
      gap: 3px;
    }
    .row .material-icons {
      font-size: 22px;
      color: #7a3cff;
      margin-right: 5px;
      vertical-align: middle;
    }
    .row .material-icons.financial {
      color: #ffd600;
    }
    .row .material-icons.support {
      color: #2196f3;
    }
    .row .material-icons.returned {
      color: #42b883;
    }
    .row .status-chip {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 3px 16px 3px 8px;
      border-radius: 15px;
      font-size: 15px;
      font-weight: 600;
      color: #fff;
      background: #90caf9;
    }
    .status-chip.approved    { background: #42b883; }
    .status-chip.not-approved{ background: #e53935; }
    .status-chip.waiting     { background: #fbc02d; color: #444; }
    .status-chip.delivered   { background: #1976d2; }
    .status-chip.completed   { background: #7a3cff; }
    .status-chip.processing  { background: #90caf9; color: #222; }
    .status-chip.cancelled   { background: #bdbdbd; color: #222; }
    .status-chip .material-icons {
      font-size: 16px;
      vertical-align: middle;
      margin-right: 2px;
      color: inherit;
    }
    .images-row {
      display: flex;
      gap: 18px;
      margin-top: 7px;
      margin-bottom: 7px;
      flex-wrap: wrap;
    }
    .product-image {
      width: 160px;
      height: 120px;
      border-radius: 12px;
      object-fit: cover;
      box-shadow: 0 2px 10px #ececec;
      border: 2px solid #eaeaea;
      background: #fff;
      cursor: pointer;
      transition: box-shadow 0.2s;
    }
    .product-image:hover {
      box-shadow: 0 6px 24px #bdbdbd;
      border-color: #7a3cff;
    }
    .support-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 18px;
      margin-top: 8px;
      margin-bottom: 6px;
    }
    .support-list .support-item {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #1976d2;
      background: #e3f2fd;
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 500;
    }
    .support-list .material-icons {
      color: #2196f3;
      font-size: 22px;
    }
    /* Financial step description */
    .step-desc {
      font-size: 16px;
      color: #8d7fc7;
      background: #f7f4ff;
      border-radius: 8px;
      margin: -10px 0 18px 10px;
      padding: 9px 18px 10px 24px;
      border-left: 3px solid #7a3cff;
    }
    .step-desc.returned {
      color: #249a60;
      background: #edfff2;
      border-left: 3px solid #42b883;
    }
    @media (max-width: 1100px) {
      .balance-tabs { flex-wrap: wrap; }
      .balance-tab { min-width: 180px; }
    }
    @media (max-width: 900px) {
      .sections-wrap { padding: 0 4vw 60px 4vw; }
      .balance-tabs { flex-direction: column; gap: 18px; margin: 34px 0 20px 16px; }
      .balance-tab { min-width: 150px; font-size: 16px; padding: 18px 10vw 15px 18px; }
      .balance-label { font-size: 14px; }
      .balance-value { font-size: 21px; }
      .section-title { font-size: 16px; }
      .card-section { border-radius: 14px; padding: 18px 10vw 12px 18px; }
      .row { font-size: 14px; gap: 12px; }
      .row .label { min-width: 90px; font-size: 13px;}
      .row .material-icons { font-size: 17px;}
      .images-row { gap: 10px; }
      .product-image { width: 100px; height: 72px; }
      .support-list { font-size: 14px; }
      .support-list .material-icons { font-size: 16px; }
      .close-modal-btn { width: 36px; height: 36px; top: 16px; right: 12px; font-size: 25px;}
      .step-desc { font-size: 12px; padding: 6px 10px 7px 14px;}
      .step-desc.returned { font-size: 12px; padding: 6px 10px 7px 14px;}
    }
    @media (max-width: 600px) {
      .title, .status-bar { padding: 0 6px; font-size: 17px;}
      .sections-wrap { padding: 0 2vw 32px 2vw; }
      .balance-tab { min-width: 80px; padding: 13px 3vw 10px 10px; }
      .section-title { font-size: 13px; }
    }
    /* Fullscreen image modal */
    .fullscreen-modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0; right: 0; bottom: 0;
      width: 100vw; height: 100vh;
      background: rgba(30,24,50,0.93);
      align-items: center;
      justify-content: center;
      flex-direction: column;
      animation: fadeIn .2s;
    }
    .fullscreen-modal.active { display: flex; }
    .fullscreen-img {
      max-width: 92vw;
      max-height: 82vh;
      border-radius: 14px;
      box-shadow: 0 6px 32px #333;
      background: #fff;
      object-fit: contain;
    }
    .close-modal-btn {
      position: absolute;
      top: 32px;
      right: 48px;
      background: rgba(30,24,50,0.4);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 48px; height: 48px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 33px;
      z-index: 10001;
      transition: background 0.2s;
    }
    .close-modal-btn:hover {
      background: #7a3cff;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="title">
      <span class="material-icons">dashboard</span>
      Pak Portal
      <span class="exchange-rate"><span class="material-icons" style="font-size:18px;vertical-align:middle;">sync_alt</span>1 PPC = 1000 PKR</span>
    </div>
    <div class="status-bar">
      <span title="Your Key" class="key-short" id="keyShort">
        <span class="material-icons">vpn_key</span>
        <span id="keyShortValue">---</span>
        <button class="delete-btn" title="Remove Key" id="deleteKeyBtn">
          <span class="material-icons">delete</span>
        </button>
      </span>
      <span title="PPC Credit" class="credit-box" id="creditBox">
        <span class="material-icons">account_balance_wallet</span>
        <span id="creditAmount">-- PPC</span>
      </span>
    </div>
  </div>
  <div class="balance-tabs" id="balanceTabs">
    <div class="balance-tab" style="border-left-color: #d32f2f;">
      <div class="balance-label"><span class="material-icons" style="color:#d32f2f;">money_off</span>Spent PPC</div>
      <div class="balance-value" id="spentPPC">--</div>
    </div>
    <div class="balance-tab">
      <div class="balance-label"><span class="material-icons">credit_score</span>Available PPC</div>
      <div class="balance-value" id="availablePPC">--</div>
    </div>
    <div class="balance-tab">
      <div class="balance-label"><span class="material-icons">pending_actions</span>In Spending</div>
      <div class="balance-value" id="spendingPPC">--</div>
    </div>
    <div class="balance-tab returned">
      <div class="balance-label returned"><span class="material-icons returned">undo</span>Returned PPC</div>
      <div class="balance-value" id="returnedPPC">1,000</div>
    </div>
  </div>
  <div class="sections-wrap">
    <div class="card-section financial">
      <div class="section-title financial"><span class="material-icons financial">account_balance</span>Financial Management</div>
      <div class="row">
        <span class="label financial"><span class="material-icons financial">add_circle</span>5000 PPC Credit Bought</span>
        <span class="date"><span class="material-icons financial">calendar_today</span>2025-06-10</span>
      </div>
      <div class="step-desc">
        5,000,000 PKR transferred to bank account of PakPortal agent in Pakistan.<br>
        <strong>Sender:</strong> Goaina Steel Plant, <strong>Account Number:</strong> XXXXX<br>
        <strong>Receiver:</strong> Usman Nasir, <strong>Account Number:</strong> XXXXX
      </div>
      <div class="row">
        <span class="label financial"><span class="material-icons financial">check_circle</span>5000 PPC Credit Made Available</span>
        <span class="date"><span class="material-icons financial">calendar_today</span>2025-06-11</span>
      </div>
      <div class="step-desc">
        5000 PPC added to the PakPortal account of Majeed Ali (Manager, Goaina) by PakPortal agent.
      </div>
      <div class="row">
        <span class="label financial"><span class="material-icons financial">shopping_cart_checkout</span>4000 PPC Credit Added to Spending</span>
        <span class="date"><span class="material-icons financial">calendar_today</span>2025-06-12</span>
      </div>
      <div class="step-desc">
        4000 PPC moved to spending for Mobile Recharge purchases.
      </div>
    </div>
    <!-- Returned PPC Section -->
    <div class="card-section" style="background:#edfff2;border-left:7px solid #42b883;">
      <div class="section-title returned">
        <span class="material-icons returned">undo</span>1000 PPC Returned
      </div>
      <div class="row">
        <span class="label returned"><span class="material-icons returned">undo</span>Date</span>
        <span class="date"><span class="material-icons returned">calendar_today</span>2025-06-20</span>
      </div>
      <div class="step-desc returned">
        100,000 PKR returned by PakPortal agent in Pakistan to Goaina.<br>
        <strong>Receiver:</strong> Goaina Steel Plant, Account Number: XXXXX<br>
        <strong>Sender:</strong> Usman Nasir, Account Number: XXXXX
      </div>
    </div>
    <div class="card-section">
      <div class="section-title"><span class="material-icons">info</span>Product Details</div>
      <div class="row">
        <span class="label"><span class="material-icons">shopping_cart</span>Product</span>
        <span class="value">Mobile Recharge</span>
      </div>
      <div class="row">
        <span class="label"><span class="material-icons">branding_watermark</span>Brand</span>
        <span class="value">Jazz Pakistan</span>
      </div>
      <div class="row">
        <span class="label"><span class="material-icons">description</span>Description</span>
        <span class="value">Prepaid mobile recharge for Jazz Pakistan numbers with instant topup delivery and support.</span>
      </div>
      <div class="row" style="align-items: flex-start;">
        <span class="label"><span class="material-icons">image</span>Images</span>
        <span class="value images-row">
          <img class="product-image" src="https://res.cloudinary.com/de3kzkvhd/image/upload/v1749534470/2pXm5tQ_bynr4g.jpg" alt="Product Image 1">
          <img class="product-image" src="https://res.cloudinary.com/de3kzkvhd/image/upload/v1749534437/7iXvJCv_dggatx.jpg" alt="Product Image 2">
        </span>
      </div>
    </div>
    <div class="card-section processing">
      <div class="section-title"><span class="material-icons">autorenew</span>Processing</div>
      <div class="row">
        <span class="label"><span class="material-icons">how_to_reg</span>Seller Accepted</span>
        <span class="value">
          <span class="status-chip approved"><span class="material-icons">check_circle</span>Yes</span>
        </span>
        <span class="date"><span class="material-icons">calendar_today</span>2025-06-13</span>
      </div>
      <div class="row">
        <span class="label"><span class="material-icons">local_shipping</span>Seller Shipped</span>
        <span class="value">
          <span class="status-chip delivered"><span class="material-icons">done_all</span>Shipped</span>
        </span>
        <span class="date"><span class="material-icons">calendar_today</span>2025-06-14</span>
      </div>
      <div class="row">
        <span class="label"><span class="material-icons">flight_takeoff</span>Left EU</span>
        <span class="value">
          <span class="status-chip delivered"><span class="material-icons">flight_takeoff</span>Yes</span>
        </span>
        <span class="date"><span class="material-icons">calendar_today</span>2025-06-15</span>
      </div>
      <div class="row">
        <span class="label"><span class="material-icons">flag</span>Reached Pakistan</span>
        <span class="value">
          <span class="status-chip waiting"><span class="material-icons">flag</span>Pending</span>
        </span>
        <span class="date"><span class="material-icons">calendar_today</span>2025-06-16</span>
      </div>
      <div class="row">
        <span class="label"><span class="material-icons">home</span>Product Delivered</span>
        <span class="value">
          <span class="status-chip waiting"><span class="material-icons">hourglass_empty</span>Waiting</span>
        </span>
        <span class="date"><span class="material-icons">calendar_today</span>2025-06-17</span>
      </div>
      <div class="row">
        <span class="label"><span class="material-icons">verified</span>Completed</span>
        <span class="value">
          <span class="status-chip completed"><span class="material-icons">verified</span>No</span>
        </span>
        <span class="date"><span class="material-icons">calendar_today</span>2025-06-18</span>
      </div>
    </div>
    <div class="card-section support">
      <div class="section-title support"><span class="material-icons support">support_agent</span>Support</div>
      <div class="support-list">
        <div class="support-item"><span class="material-icons">build_circle</span>Spareparts</div>
        <div class="support-item"><span class="material-icons">home_repair_service</span>Repairing</div>
        <div class="support-item"><span class="material-icons">menu_book</span>Instructions</div>
      </div>
    </div>
  </div>
  <!-- Fullscreen Image Modal -->
  <div class="fullscreen-modal" id="fullscreenModal">
    <button class="close-modal-btn" id="closeModalBtn" title="Close">
      <span class="material-icons">close</span>
    </button>
    <img class="fullscreen-img" id="fullscreenImg" src="" alt="Full Image">
  </div>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
  <script>
    // NFTFAN contract (PPC) on Polygon
    const NFTFAN_CA = "0x2017Fcaea540d2925430586DC92818035Bfc2F50";
    const ERC20_ABI = [
      {"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"},
      {"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"type":"function"}
    ];
    const KEY_STORAGE = "PPC-key";
    const web3 = new Web3("https://polygon-rpc.com/");
    const nftfan = new web3.eth.Contract(ERC20_ABI, NFTFAN_CA);

    function formatNumber(numStr, decimals) {
      if (!numStr) return "--";
      try {
        let n = BigInt(numStr);
        let div = BigInt(10) ** BigInt(decimals);
        let w = n / div;
        return w.toLocaleString('en-US');
      } catch {
        return "--";
      }
    }

    function shortKey(addr) {
      if (!addr) return "---";
      return addr.slice(0, 6) + "..." + addr.slice(-4);
    }

    // Simulate spending and spent for demo (can be adapted to fetch real spending)
    function simulateSpending(balance) {
      if (!balance || isNaN(balance.replace(/,/g,''))) return "--";
      let v = parseInt(balance.replace(/,/g,''), 10);
      return Math.floor(v * 0.2).toLocaleString('en-US'); // 20% as 'in spending'
    }
    function simulateSpent(balance) {
      if (!balance || isNaN(balance.replace(/,/g,''))) return "--";
      let v = parseInt(balance.replace(/,/g,''), 10);
      return Math.floor(v * 0.6).toLocaleString('en-US'); // 60% as 'spent'
    }
    // Fake returned PPC for demo
    function getReturnedPPC() {
      return "1,000";
    }

    function updateUI(addr, balanceStr) {
      document.getElementById('keyShortValue').textContent = shortKey(addr);
      document.getElementById('creditAmount').textContent = (balanceStr ? balanceStr : '--') + " PPC";
      document.getElementById('availablePPC').textContent = balanceStr || "--";
      document.getElementById('spendingPPC').textContent = simulateSpending(balanceStr) + " PPC";
      document.getElementById('spentPPC').textContent = simulateSpent(balanceStr) + " PPC";
      document.getElementById('returnedPPC').textContent = getReturnedPPC();
    }

    async function fetchPPC(addr) {
      try {
        const [bal, dec] = await Promise.all([
          nftfan.methods.balanceOf(addr).call(),
          nftfan.methods.decimals().call()
        ]);
        let balStr = formatNumber(bal, dec);
        updateUI(addr, balStr);
      } catch (e) {
        updateUI(addr, "--");
      }
    }

    function getStoredKey() {
      return localStorage.getItem(KEY_STORAGE);
    }

    function askForKey() {
      let addr = prompt("Enter Your Key (Polygon address 0x...):", "");
      if (!addr || !/^0x[a-fA-F0-9]{40}$/.test(addr.trim())) {
        alert("Please enter a valid Polygon (Ethereum) address.");
        return askForKey();
      }
      localStorage.setItem(KEY_STORAGE, addr.trim());
      return addr.trim();
    }

    // Handle delete key
    document.getElementById('deleteKeyBtn').onclick = function() {
      localStorage.removeItem(KEY_STORAGE);
      location.reload();
    };

    // Fullscreen image modal logic
    function showFullscreenImage(src) {
      var modal = document.getElementById('fullscreenModal');
      var img = document.getElementById('fullscreenImg');
      img.src = src;
      modal.classList.add('active');
    }
    function closeFullscreenImage() {
      var modal = document.getElementById('fullscreenModal');
      modal.classList.remove('active');
      document.getElementById('fullscreenImg').src = "";
    }

    // Add click event to product images after DOM loads
    document.addEventListener("DOMContentLoaded", function() {
      var images = document.querySelectorAll('.product-image');
      images.forEach(function(img) {
        img.addEventListener('click', function() {
          showFullscreenImage(img.src);
        });
      });
      document.getElementById('closeModalBtn').onclick = closeFullscreenImage;
      document.getElementById('fullscreenModal').onclick = function(e) {
        if (e.target === this) closeFullscreenImage();
      };
    });

    // On load
    (function() {
      let addr = getStoredKey();
      if (!addr || !/^0x[a-fA-F0-9]{40}$/.test(addr)) {
        addr = askForKey();
      }
      fetchPPC(addr);
      setInterval(() => fetchPPC(addr), 60000); // every 60 seconds
    })();
  </script>
</body>
</html>
