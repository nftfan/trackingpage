<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FOODPHOTO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Material Icons CDN -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --primary: #388e3c;
      --accent: #fffde7;
      --border: #e0e0e0;
      --shadow: 0 2px 10px #0002;
      --tab-active: #fffde7;
      --tab-inactive: #e0e0e0;
      font-size: 11px;
      font-family: 'Roboto', Arial, sans-serif;
    }
    body {
      margin: 0;
      background: #f5f7fa;
      color: #222;
      min-height: 100vh;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--primary);
      color: white;
      padding: 10px 12px;
      font-size: 1.3em;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    .header-title {
      font-weight: bold;
      letter-spacing: 1px;
    }
    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .camera-btn, .search-btn {
      background: none;
      border: none;
      color: white;
      font-size: 2em;
      cursor: pointer;
      outline: none;
      padding: 0;
    }
    .search-bar-container {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #fff;
      border-bottom: 1px solid var(--border);
      padding: 2px 0 2px 0;
      transition: max-height 0.2s;
    }
    .search-bar {
      display: flex;
      align-items: center;
      width: 95%;
      max-width: 400px;
      margin: 0 auto;
      background: #f3f3f3;
      border-radius: 7px;
      border: 1px solid var(--border);
      padding: 3px 8px;
      font-size: 1em;
      gap: 5px;
    }
    .search-bar input {
      border: none;
      background: transparent;
      font-size: 1em;
      outline: none;
      width: 100%;
      padding: 6px 0;
      color: #222;
    }
    .search-bar .material-icons {
      color: #388e3c;
      font-size: 1.3em;
    }
    .tabs {
      display: flex;
      overflow-x: auto;
      background: #fff;
      border-bottom: 1px solid var(--border);
      margin-bottom: 4px;
    }
    .tab {
      flex: 1 0 auto;
      padding: 7px 12px;
      border: none;
      outline: none;
      background: var(--tab-inactive);
      color: #333;
      cursor: pointer;
      font-size: 1em;
      transition: background 0.2s;
      border-right: 1px solid var(--border);
      border-bottom: 2px solid transparent;
      white-space: nowrap;
    }
    .tab:last-child { border-right: none; }
    .tab.active {
      background: var(--tab-active);
      color: var(--primary);
      border-bottom: 2px solid var(--primary);
      font-weight: bold;
    }
    .main {
      padding: 10px 6px 10px 6px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 18px;
    }
    @media (min-width: 390px) {
      .grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (min-width: 700px) {
      .grid { grid-template-columns: repeat(3, 1fr); }
    }
    /* Redesigned Card */
    .item-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: var(--shadow);
      border: none;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-height: 240px;
      transition: box-shadow 0.18s, transform 0.15s;
      position: relative;
      cursor: pointer;
    }
    .item-card:hover {
      box-shadow: 0 4px 15px #0003;
      transform: translateY(-2px) scale(1.012);
    }
    .item-imgs {
      position: relative;
      width: 100%;
      aspect-ratio: 5/3;
      background: linear-gradient(120deg, #f8fafc, #e7fce3);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .item-imgs img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 0;
      transition: filter 0.18s;
    }
    .item-imgs .img-thumbs {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      z-index: 2;
    }
    .item-imgs .img-thumbs img {
      width: 26px;
      height: 26px;
      border-radius: 5px;
      border: 2px solid #fff;
      box-shadow: 0 1px 3px #0002;
      opacity: 0.7;
      background: #fff;
      cursor: pointer;
      object-fit: cover;
      transition: opacity 0.18s, border 0.18s;
    }
    .item-imgs .img-thumbs img.selected {
      opacity: 1;
      border: 2px solid var(--primary);
    }
    .item-content {
      display: flex;
      flex-direction: column;
      gap: 0;
      padding: 13px 14px 10px 14px;
      flex: 1 1 auto;
    }
    .item-title {
      font-weight: bold;
      color: #222;
      font-size: 1.2em;
      margin-bottom: 2px;
      line-height: 1.35;
      letter-spacing: 0.5px;
      word-break: break-word;
    }
    .item-brand {
      color: #388e3c;
      font-size: 1em;
      font-weight: 500;
      margin-bottom: 4px;
      letter-spacing: .2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .item-desc {
      color: #555;
      font-size: 1em;
      margin-bottom: 6px;
      line-height: 1.35;
      max-height: 2.7em;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    .item-details-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 4px;
      gap: 10px;
    }
    .item-tag {
      display: inline-block;
      background: linear-gradient(90deg, #e8f5e9 70%, #e3f3fb 100%);
      border-radius: 6px;
      padding: 2px 10px;
      font-size: 1em;
      color: #388e3c;
      font-weight: 600;
      letter-spacing: .4px;
      margin: 0;
      box-shadow: 0 1px 3px #0001;
    }
    .item-whatsapp {
      display: flex;
      align-items: center;
      gap: 3px;
      color: #077f3f;
      font-size: 1em;
      font-weight: 500;
    }
    .item-whatsapp a {
      color: inherit;
      text-decoration: underline;
      font-size: 1em;
      font-weight: 500;
    }
    /* Modal Styles */
    .modal-bg,
    .popup-bg {
      position: fixed;
      z-index: 99;
      inset: 0;
      background: #0006;
      display: none;
      align-items: flex-end;
      justify-content: center;
    }
    .modal-bg.active,
    .popup-bg.active { display: flex; }
    .modal,
    .popup {
      background: #fff;
      border-radius: 12px 12px 0 0;
      padding: 16px 14px 12px 14px;
      width: 100vw;
      max-width: 440px;
      box-shadow: 0 -2px 12px #0003;
      font-size: 1em;
      animation: modalIn 0.22s;
      position: relative;
    }
    @keyframes modalIn {
      from { transform: translateY(40px); opacity: 0; }
      to { transform: none; opacity: 1; }
    }
    .modal h2 {
      margin: 0 0 8px 0;
      font-size: 1.2em;
      font-weight: bold;
      color: #388e3c;
      letter-spacing: 1px;
    }
    .modal label {
      display: block;
      margin: 6px 0 2px 0;
      font-size: 1em;
      color: #444;
      font-weight: 500;
    }
    .modal input, .modal select, .modal textarea {
      width: 100%;
      font-size: 1em;
      padding: 7px 8px;
      border: 1px solid var(--border);
      border-radius: 5px;
      margin-bottom: 7px;
      background: #fafafa;
    }
    .modal textarea {
      resize: vertical;
      min-height: 40px;
      max-height: 100px;
    }
    .modal .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 4px;
    }
    .modal button {
      padding: 7px 18px;
      border-radius: 5px;
      border: none;
      font-size: 1em;
      cursor: pointer;
      font-weight: bold;
      background: var(--primary);
      color: #fff;
      transition: background 0.2s;
    }
    .modal button.cancel {
      background: #eee;
      color: #333;
      font-weight: normal;
    }
    .modal .img-preview {
      display: flex;
      gap: 5px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .modal .img-preview img {
      width: 44px;
      height: 44px;
      border-radius: 4px;
      object-fit: cover;
      border: 1px solid var(--border);
    }
    /* Camera Preview */
    .camera-preview {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-bottom: 5px;
    }
    .camera-preview video {
      border-radius: 7px;
      border: 1px solid var(--border);
      width: 100%;
      max-width: 280px;
      max-height: 180px;
      background: #000;
    }
    .capture-btn-row {
      display: flex;
      justify-content: center;
      margin: 7px 0 0 0;
      gap: 8px;
    }
    .capture-btn {
      background: #388e3c;
      color: #fff;
      border: none;
      font-size: 1.7em;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .capture-btn:disabled {
      background: #ccc;
      color: #888;
      cursor: not-allowed;
    }
    /* Fullscreen Image Popup */
    .popup-bg {
      align-items: center !important;
      justify-content: center !important;
      background: #111c;
    }
    .popup-img-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #222;
      border-radius: 18px;
      padding: 0;
      max-width: 95vw;
      max-height: 90vh;
      position: relative;
    }
    .popup-img {
      max-width: 87vw;
      max-height: 80vh;
      border-radius: 14px;
      display: block;
      background: #222;
      margin: 0;
      box-shadow: 0 4px 24px #0005;
      transition: box-shadow 0.22s;
    }
    .popup-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: #fff;
      color: #388e3c;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 2em;
      box-shadow: 0 2px 8px #0003;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      opacity: 0.93;
      z-index: 11;
      transition: background 0.13s;
    }
    .popup-arrow:active { background: #d0f2e4; }
    .popup-arrow.left { left: -47px; }
    .popup-arrow.right { right: -47px; }
    @media (max-width: 500px) {
      .popup-arrow.left { left: 2px; }
      .popup-arrow.right { right: 2px; }
    }
    .popup-close {
      background: #fff;
      border: none;
      border-radius: 0 0 12px 12px;
      padding: 7px 0;
      width: 100%;
      font-size: 1.09em;
      font-weight: bold;
      color: #388e3c;
      cursor: pointer;
      box-shadow: 0 2px 4px #0001;
      margin-top: 10px;
      transition: background 0.18s;
    }
    .popup-close:active { background: #e8f5e9; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <span class="header-title">FOODPHOTO</span>
    <span class="header-actions">
      <button class="search-btn" id="openSearchBtn" aria-label="Search">
        <span class="material-icons">search</span>
      </button>
      <button class="camera-btn" id="openModalBtn" aria-label="Add Food Photo">
        <span class="material-icons">photo_camera</span>
      </button>
    </span>
  </div>
  <!-- SEARCH BAR -->
  <div class="search-bar-container" id="searchBarContainer" style="display:none;">
    <form class="search-bar" id="searchForm" autocomplete="off">
      <span class="material-icons">search</span>
      <input type="text" id="searchInput" placeholder="Search foods, brands, tags, descriptions..." maxlength="40" />
      <button type="button" class="camera-btn" id="closeSearchBtn" aria-label="Close Search" style="color:#c62828;font-size:1.3em;">
        <span class="material-icons">close</span>
      </button>
    </form>
  </div>
  <!-- TAGS AS TABS -->
  <div class="tabs" id="tagsTabs"></div>
  <!-- MAIN GRID -->
  <div class="main">
    <div class="grid" id="itemsGrid"></div>
  </div>
  <!-- MODAL FOR ADDING ITEM -->
  <div class="modal-bg" id="modalBg">
    <form class="modal" id="itemForm" autocomplete="off">
      <h2>Add Food Photo</h2>
      <div class="camera-preview" id="cameraPreview">
        <video id="video" autoplay playsinline></video>
      </div>
      <div class="capture-btn-row">
        <button type="button" class="capture-btn" id="captureBtn" title="Take Photo">
          <span class="material-icons">camera_alt</span>
        </button>
        <button type="button" class="capture-btn" id="clearPhotosBtn" title="Clear Photos" style="background:#c62828;">
          <span class="material-icons">delete</span>
        </button>
      </div>
      <div class="img-preview" id="imgPreview"></div>
      <label for="foodName">Food Name</label>
      <input id="foodName" name="foodName" type="text" maxlength="30" required>
      <label for="brandName">Brand Name</label>
      <input id="brandName" name="brandName" type="text" maxlength="30" required>
      <label for="desc">Description</label>
      <textarea id="desc" name="desc" maxlength="120" required placeholder="Describe the food, expiry, etc."></textarea>
      <label for="whatsapp">WhatsApp Number</label>
      <input id="whatsapp" name="whatsapp" type="tel" pattern="^(\+?\d{10,15})$" maxlength="16" required placeholder="+919999999999">
      <label for="foodTag">Food Tag</label>
      <select id="foodTag" name="foodTag" required>
        <!-- Populated by JS -->
      </select>
      <div class="modal-actions">
        <button type="button" class="cancel" id="cancelBtn">Cancel</button>
        <button type="submit">Add</button>
      </div>
    </form>
  </div>
  <!-- IMAGE POPUP FULLSCREEN -->
  <div class="popup-bg" id="popupBg">
    <div class="popup-img-wrap" id="popupImgWrap" style="display:flex;flex-direction:row;align-items:center;">
      <button class="popup-arrow left" id="popupArrowLeft" aria-label="Previous" style="display:none;"><span class="material-icons">chevron_left</span></button>
      <img class="popup-img" id="popupImg" src="" alt="Food photo">
      <button class="popup-arrow right" id="popupArrowRight" aria-label="Next" style="display:none;"><span class="material-icons">chevron_right</span></button>
    </div>
    <button class="popup-close" id="popupCloseBtn">Close</button>
  </div>
  <script>
    // 10 Food Tags
    const TAGS = [
      "Fruits", "Vegetables", "Snacks", "Bakery", "Dairy",
      "Meat", "Seafood", "Beverages", "Frozen", "Grains"
    ];
    // UI Elements
    const tagsTabs = document.getElementById('tagsTabs');
    const itemsGrid = document.getElementById('itemsGrid');
    const modalBg = document.getElementById('modalBg');
    const openModalBtn = document.getElementById('openModalBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const itemForm = document.getElementById('itemForm');
    const foodTagSelect = document.getElementById('foodTag');
    const imgPreview = document.getElementById('imgPreview');
    const cameraPreview = document.getElementById('cameraPreview');
    const video = document.getElementById('video');
    const captureBtn = document.getElementById('captureBtn');
    const clearPhotosBtn = document.getElementById('clearPhotosBtn');
    // Popup
    const popupBg = document.getElementById('popupBg');
    const popupImg = document.getElementById('popupImg');
    const popupImgWrap = document.getElementById('popupImgWrap');
    const popupCloseBtn = document.getElementById('popupCloseBtn');
    const popupArrowLeft = document.getElementById('popupArrowLeft');
    const popupArrowRight = document.getElementById('popupArrowRight');
    // Search
    const openSearchBtn = document.getElementById('openSearchBtn');
    const closeSearchBtn = document.getElementById('closeSearchBtn');
    const searchBarContainer = document.getElementById('searchBarContainer');
    const searchForm = document.getElementById('searchForm');
    const searchInput = document.getElementById('searchInput');
    // State
    let items = [];
    let activeTag = 'All';
    let capturedImages = [];
    let cameraStream = null;
    let searchQuery = '';
    // Popup State
    let popupItemIdx = 0;
    let popupImgIdx = 0;
    let popupImages = [];

    // Populate tags as tabs
    function renderTags() {
      tagsTabs.innerHTML = '';
      const allTab = document.createElement('button');
      allTab.textContent = 'All';
      allTab.className = 'tab' + (activeTag === 'All' ? ' active' : '');
      allTab.onclick = () => { setActiveTag('All'); };
      tagsTabs.appendChild(allTab);
      TAGS.forEach(tag => {
        const btn = document.createElement('button');
        btn.textContent = tag;
        btn.className = 'tab' + (activeTag === tag ? ' active' : '');
        btn.onclick = () => { setActiveTag(tag); };
        tagsTabs.appendChild(btn);
      });
    }
    function setActiveTag(tag) {
      activeTag = tag;
      renderTags();
      renderItems();
    }
    // Populate select options for tags
    function renderTagOptions() {
      foodTagSelect.innerHTML = TAGS.map(tag =>
        `<option value="${tag}">${tag}</option>`
      ).join('');
    }
    // Render grid items with filtering and new design
    function renderItems() {
      let filtered = items;
      if (activeTag !== 'All') {
        filtered = filtered.filter(item => item.foodTag === activeTag);
      }
      if (searchQuery.trim() !== '') {
        const q = searchQuery.trim().toLowerCase();
        filtered = filtered.filter(item =>
          (item.foodName && item.foodName.toLowerCase().includes(q)) ||
          (item.brandName && item.brandName.toLowerCase().includes(q)) ||
          (item.desc && item.desc.toLowerCase().includes(q)) ||
          (item.whatsapp && item.whatsapp.toLowerCase().includes(q)) ||
          (item.foodTag && item.foodTag.toLowerCase().includes(q))
        );
      }
      itemsGrid.innerHTML = filtered.map((item, idx) => {
        // show first image as main, thumbs for others if more than 1
        const mainImg = item.images[0];
        const thumbs = item.images.length > 1
          ? `<div class="img-thumbs">${
              item.images.map((img, j) =>
                `<img src="${img}" class="${j === 0 ? 'selected' : ''}" data-item="${idx}" data-img="${j}" tabindex="0">`
              ).join('')
            }</div>`
          : '';
        return `
        <div class="item-card" data-item="${idx}">
          <div class="item-imgs" data-item="${idx}">
            <img src="${mainImg}" alt="Food image" data-item="${idx}" data-img="0">
            ${thumbs}
          </div>
          <div class="item-content">
            <div class="item-title">${item.foodName}</div>
            <div class="item-brand">${item.brandName}</div>
            <div class="item-desc">${item.desc}</div>
            <div class="item-details-row">
              <div class="item-tag">${item.foodTag}</div>
              <div class="item-whatsapp">
                <span class="material-icons" style="font-size:1em;vertical-align:-2px;">whatsapp</span>
                <a href="https://wa.me/${item.whatsapp.replace(/\D/g,'')}" target="_blank">${item.whatsapp}</a>
              </div>
            </div>
          </div>
        </div>
        `;
      }).join('');
      setTimeout(() => {
        // Add click listeners for main image and thumbs
        document.querySelectorAll('.item-imgs').forEach(imgsDiv => {
          const idx = parseInt(imgsDiv.getAttribute('data-item'));
          const item = filtered[idx];
          const mainImgEl = imgsDiv.querySelector('img[alt="Food image"]');
          mainImgEl.onclick = () => openImagePopup(item, 0, filtered, idx);
        });
        document.querySelectorAll('.img-thumbs img').forEach(thumbEl => {
          thumbEl.onclick = e => {
            const itemIdx = parseInt(thumbEl.getAttribute('data-item'));
            const imgIdx = parseInt(thumbEl.getAttribute('data-img'));
            openImagePopup(filtered[itemIdx], imgIdx, filtered, itemIdx);
            e.stopPropagation();
          };
          thumbEl.onkeydown = e => {
            if (e.key === "Enter" || e.key === " ") thumbEl.onclick(e);
          };
        });
        // Clicking the card (not on thumb or main image) also opens popup
        document.querySelectorAll('.item-card').forEach(cardEl => {
          const idx = parseInt(cardEl.getAttribute('data-item'));
          cardEl.onclick = (e) => {
            if (e.target.tagName === "IMG") return;
            openImagePopup(filtered[idx], 0, filtered, idx);
          };
        });
      }, 15);
    }
    // Modal functions
    function openModal() {
      modalBg.classList.add('active');
      itemForm.reset();
      imgPreview.innerHTML = '';
      capturedImages = [];
      startCamera();
      setTimeout(() => {
        itemForm.foodName.focus();
      }, 200);
    }
    function closeModal() {
      modalBg.classList.remove('active');
      stopCamera();
      itemForm.reset();
      imgPreview.innerHTML = '';
      capturedImages = [];
    }
    // Camera Functions (no upload, only camera)
    async function startCamera() {
      stopCamera();
      try {
        cameraStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment", width: {ideal: 640}, height: {ideal: 480} },
          audio: false
        });
        video.srcObject = cameraStream;
        captureBtn.disabled = false;
      } catch (e) {
        cameraPreview.innerHTML = '<div style="color:#c62828;text-align:center;">Camera access denied/unavailable.</div>';
        captureBtn.disabled = true;
      }
    }
    function stopCamera() {
      video.srcObject = null;
      if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
        cameraStream = null;
      }
      captureBtn.disabled = true;
    }
    function updateImgPreview() {
      imgPreview.innerHTML = '';
      capturedImages.forEach((url, i) => {
        const img = document.createElement('img');
        img.src = url;
        imgPreview.appendChild(img);
      });
    }
    captureBtn.onclick = function(e) {
      e.preventDefault();
      if (!cameraStream) return;
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth || 320;
      canvas.height = video.videoHeight || 240;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imgDataUrl = canvas.toDataURL('image/jpeg', 0.92);
      capturedImages.push(imgDataUrl);
      updateImgPreview();
    };
    clearPhotosBtn.onclick = function(e) {
      e.preventDefault();
      capturedImages = [];
      updateImgPreview();
    };
    // Form submit
    itemForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const foodName = this.foodName.value.trim();
      const brandName = this.brandName.value.trim();
      const desc = this.desc.value.trim();
      const whatsapp = this.whatsapp.value.trim();
      const foodTag = this.foodTag.value;
      if (!foodName || !brandName || !desc || !whatsapp || !foodTag || !capturedImages.length) {
        alert('Please fill all fields and capture at least one photo.');
        return;
      }
      items.unshift({
        images: [...capturedImages],
        foodName,
        brandName,
        desc,
        whatsapp,
        foodTag,
      });
      closeModal();
      renderItems();
    });
    // Modal open/close
    openModalBtn.onclick = openModal;
    cancelBtn.onclick = closeModal;
    modalBg.onclick = function(e) {
      if (e.target === modalBg) closeModal();
    };
    // Fullscreen Image Popup
    function openImagePopup(item, imgIdx, filtered, filteredIdx) {
      popupImages = item.images;
      popupItemIdx = filteredIdx; // for search order
      popupImgIdx = imgIdx;
      showPopupImage();
      popupBg.classList.add('active');
    }
    function showPopupImage() {
      if (!popupImages.length) return;
      popupImg.src = popupImages[popupImgIdx];
      popupImg.alt = "Food photo";
      // Arrows visibility
      popupArrowLeft.style.display = popupImgIdx > 0 ? 'flex' : 'none';
      popupArrowRight.style.display = popupImgIdx < popupImages.length - 1 ? 'flex' : 'none';
    }
    popupArrowLeft.onclick = function(e) {
      if (popupImgIdx > 0) {
        popupImgIdx--;
        showPopupImage();
      }
    };
    popupArrowRight.onclick = function(e) {
      if (popupImgIdx < popupImages.length - 1) {
        popupImgIdx++;
        showPopupImage();
      }
    };
    popupCloseBtn.onclick = function() {
      popupBg.classList.remove('active');
      popupImg.src = '';
      popupImages = [];
      popupImgIdx = 0;
    };
    popupBg.onclick = function(e) {
      if (e.target === popupBg) popupCloseBtn.onclick();
    };
    // Keyboard navigation for arrows
    document.addEventListener('keydown', function(e) {
      if (!popupBg.classList.contains('active')) return;
      if (e.key === "ArrowLeft" && popupImgIdx > 0) {
        popupArrowLeft.onclick();
      }
      if (e.key === "ArrowRight" && popupImgIdx < popupImages.length - 1) {
        popupArrowRight.onclick();
      }
      if (e.key === "Escape") {
        popupCloseBtn.onclick();
      }
    });
    // Search Bar Logic
    openSearchBtn.onclick = function() {
      searchBarContainer.style.display = 'flex';
      searchInput.value = '';
      searchQuery = '';
      renderItems();
      setTimeout(() => searchInput.focus(), 100);
    };
    closeSearchBtn.onclick = function() {
      searchBarContainer.style.display = 'none';
      searchInput.value = '';
      searchQuery = '';
      renderItems();
    };
    searchForm.onsubmit = function(e) {
      e.preventDefault();
      searchQuery = searchInput.value || '';
      renderItems();
    };
    searchInput.oninput = function() {
      searchQuery = searchInput.value || '';
      renderItems();
    };
    // Initial render
    renderTags();
    renderTagOptions();
    renderItems();
    // Prevent page scroll behind modals
    [modalBg, popupBg].forEach(bg => {
      bg.addEventListener('wheel', e => e.preventDefault(), { passive: false });
      bg.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
    });
  </script>
</body>
</html>
